--- RUTA: api.js ---
// src/api.js
export const BASE_URL = import.meta.env.VITE_API_BASE || 'http://127.0.0.1:8090'

async function fetchJson(path, opts = {}) {
  const url = BASE_URL + path
  const res = await fetch(url, opts)
  if (!res.ok) throw new Error(`${res.status} ${res.statusText}: ${await res.text()}`)
  return res.json().catch(() => null)
}

// helper para POST JSON
async function postJson(path, body, opts = {}) {
  const url = BASE_URL + path
  const res = await fetch(url, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', ...(opts.headers||{}) },
    body: JSON.stringify(body),
    credentials: opts.credentials || 'include',
    ...opts.fetchOptions
  })
  if(!res.ok){
    const txt = await res.text().catch(()=>null)
    throw new Error(`${res.status} ${res.statusText}: ${txt}`)
  }
  return res.json().catch(()=>null)
}

export const API = {
  getDevices: () => fetchJson('/api/devices'),
  getSensors: () => fetchJson('/api/sensors'),
  getSensorsByDevice: (memberId) => fetchJson(`/api/sensors?member_id=${encodeURIComponent(memberId)}`),
  // params: string starting with ? OR an object { member_id: '...' }
  getSensorReadings: (params) => {
    if (!params) return fetchJson('/api/sensor_readings')
    if (typeof params === 'string') {
      // already contains leading ?
      return fetchJson('/api/sensor_readings' + params)
    }
    const qs = new URLSearchParams(params).toString()
    return fetchJson('/api/sensor_readings' + (qs ? `?${qs}` : ''))
  },
  getNotifications: (params = {}) => {
    const qs = new URLSearchParams(params).toString()
    return fetchJson('/api/notifications' + (qs ? `?${qs}` : ''))
  },

  post: (path, body) => postJson(path, body, { credentials: 'include' }),
  
  // --- LOGIN ---
  // creds: { username, password }
  login: (creds) => postJson('/api/login', creds, { credentials: 'include' }),

  // opcional: logout
  logout: () => postJson('/api/logout', {}, { credentials: 'include' }),
}


================================================================================

--- RUTA: App.vue ---
<script setup>
import { useRoute } from 'vue-router'
const route = useRoute()
</script>

<template>
  <!-- Si estamos en login pantalla completa -->
  <div v-if="route.name === 'login' || route.name === 'reset-password'">
    <router-view />
  </div>

  <!-- Layout normal -->
  <div v-else>
    <router-view />
  </div>
</template>

<style>
/* nada aquí — dejamos estilos en assets/brand.css */
</style>


================================================================================

--- RUTA: main.js ---
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import './assets/brand.css'   // ahora importamos el fichero único de estilos

createApp(App).use(router).mount('#app')


================================================================================

--- RUTA: assets\brand.css ---
/* src/assets/brand.css
   Contiene: reset global + paleta + layout + topbar/sidebar + login + dashboard
   Sustituye y agrupa TODO lo necesario que antes estaba en styles.css y brand.css parcial.
*/

/* -------------------------
   RESET / BASE
   ------------------------- */
:root{
  /* layout sizes */
  --topbar-h: 64px;
  --sidebar-w: 14%;
  --sidebar-w-collapsed: 64px;

  /* colors */
  --brand-black: #0b0b0b;    /* topbar & sidebar */
  --brand-500: #2b8cff;      /* accent (si se necesita) */
  --bg: #f7fafc;             /* content background */
  --card-bg: #ffffff;
  --muted: #9aa0a6;

  /* misc */
  --radius: 10px;
  --shadow: 0 10px 30px rgba(2,6,23,0.06);
}

/* ensure app full-bleed */
html, body, #app {
  height: 100%;
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: #111;
  font-family: "Inter", Arial, Helvetica, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overflow: hidden; /* body-level scroll disabled; scroll handled by .content */
  box-sizing: border-box;
}

/* make sure every element uses border-box */
*, *::before, *::after { box-sizing: inherit; }

/* A generic "app" wrapper - full width/height */
.app-wrapper, .app { width: 100%; height: 100%; margin:0; padding:0; }

/* -------------------------
   MAIN LAYOUT
   ------------------------- */
.main-layout {
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* TOPBAR (negro, conectado visualmente con sidebar) */
.topbar {
  height: var(--topbar-h);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  background: var(--brand-black);
  color: #fff;
  box-shadow: 0 6px 18px rgba(0,0,0,0.10);
  z-index: 40;
  gap: 12px;
}

/* main-body ocupa toda la ventana disponible debajo del topbar */
.main-body {
  display: flex;
  flex: 1 1 auto;
  min-height: 0; /* important so children with overflow work */
  height: calc(100vh - var(--topbar-h));
}

/* El menú no debe romper el flex principal */
.menu-list {
  display:flex;
  flex-direction:column;
  gap:6px;
}

/* SIDEBAR (NEGRO) */
.sidebar {
  width: var(--sidebar-w);
  min-width: var(--sidebar-w);
  max-width: var(--sidebar-w);
  background: var(--brand-black);
  color: #fff;
  padding: 12px;
  border-right: 1px solid rgba(255,255,255,0.02);
  box-shadow: 0 6px 18px rgba(2,6,23,0.03);
  transition: width 220ms ease, transform 220ms ease;
  overflow: hidden;

  /* CLAVE: layout vertical que ocupa todo */
  display:flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
}

/* Espaciador que EMPUJA al footer hacia abajo */
.sidebar-spacer {
  flex: 1 1 auto !important; /* MUY IMPORTANTE */
  min-height: 0;
}

/* collapsed state (small, icon-only) */
.sidebar.collapsed {
  width: var(--sidebar-w-collapsed);
  min-width: var(--sidebar-w-collapsed);
  max-width: var(--sidebar-w-collapsed);
}

/* menu items */
.sidebar .menu-item {
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px;
  border-radius:8px;
  cursor:pointer;
  color: #fff;
  background: transparent;
  border: none;
  text-align: left;
}
.sidebar .menu-item:hover { background: rgba(255,255,255,0.03); }

/* icons + labels */
.sidebar .menu-icon { width:28px; height:28px; display:inline-flex; align-items:center; justify-content:center; }
.sidebar.collapsed .menu-label { display: none; }

/* Footer de la sidebar */
.sidebar-footer {
  margin-top: auto !important; /* El seguro definitivo */
  display:flex;
  align-items:center;
  gap:10px;
  padding:8px;
  border-radius:8px;
  color:#fff;
}

.sidebar-footer .avatar {
  width:36px; height:36px; display:flex; align-items:center; justify-content:center; border-radius:6px;
  background: rgba(255,255,255,0.03);
}
.sidebar-footer .user-meta { display:flex; flex-direction:column; gap:4px; }
.sidebar-footer.collapsed { justify-content:center; padding:6px; }
.sidebar-footer.collapsed .user-meta { display:none; }
.user-name { font-weight:600; font-size:0.95rem; color:#fff; }
.link.small { background:transparent; border:none; color:rgba(255,255,255,0.75); padding:0; cursor:pointer; font-size:0.85rem; text-align:left; }

/* content area (panel principal) */
.content {
  background-color: #fff;
  flex: 1 1 auto;
  min-height: 0;
  padding: 18px;
  background: var(--bg);
  overflow: auto; /* scroll internal to content */
}

/* small helpers */
.brand { display:flex; align-items:center; gap:10px; }
.logo { height:32px; border-radius:6px; }

/* Topbar toggle button */
.toggle-btn {
  width:40px;
  height:40px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  background: transparent;
  border:1px solid rgba(255,255,255,0.06);
  color:#fff;
  border-radius:8px;
  cursor:pointer;
}
.toggle-btn:active { transform: translateY(1px); }

/* top actions (right side of topbar) */
.top-actions { display:flex; align-items:center; gap:10px; }

/* -------------------------
   LOGIN PAGE (pantalla centrada)
   ------------------------- */
.login-page {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(180deg, #f6fbff, var(--bg));
  padding: 24px;
  box-sizing: border-box;
}

/* login card */
.login-card {
  width: 420px;
  max-width: calc(100% - 48px);
  background: var(--card-bg);
  border-radius: 12px;
  padding: 26px;
  box-shadow: var(--shadow);
  box-sizing: border-box;
}
.login-title { font-size:1.25rem; margin:0 0 6px 0; }
.small-muted { color: var(--muted); font-size:0.95rem; margin-top:4px; }

/* inputs & buttons used across app */
.input {
  width: 100%;
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid #e6e9ef;
  box-sizing: border-box;
}
.btn {
  background: var(--brand-500);
  color: #fff;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
}
.btn.ghost {
  background: transparent;
  color: var(--brand-500);
  border: 1px solid rgba(43,140,255,0.12);
}

/* small variations */
.error { color: #c0392b; margin-top: 8px; }

/* -------------------------
   DASHBOARD / COMPONENT HELPERS
   ------------------------- */
/* ensure the dashboard container can grow full height */
.dashboard {
  display:flex;
  gap:18px;
  align-items:flex-start;
  height: 100%;
  min-height: 0;
}

/* left column */
.left { width: 320px; }

/* right column with charts and scroll */
.right {
  flex: 1 1 auto;
  min-height: 0;
  background: #fafafa;
  padding: 18px;
  border-radius: 8px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.03);
  overflow: auto;
}

/* responsive adjustments */
@media (max-width: 900px) {
  .sidebar { position: fixed; z-index: 50; left: 0; top: var(--topbar-h); bottom: 0; transform: translateX(0); }
  .main-body { padding-left: 0; }
}

/* focus styles (accessibility) */
.toggle-btn:focus, .menu-item:focus, .btn:focus, .input:focus {
  outline: 2px solid rgba(43,140,255,0.12);
  outline-offset: 2px;
}

/* small utility classes */
.hint { color:#444; padding:24px; text-align:center }
.legend { margin-top:24px; background:#fff; padding:12px; border-radius:8px; box-shadow:0 8px 20px rgba(0,0,0,0.03) }


================================================================================

--- RUTA: assets\logo.svg ---
<?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 16.0.3, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="1024px" height="1024px" viewBox="0 0 1024 1024" enable-background="new 0 0 1024 1024" xml:space="preserve">
<g>
	<g>
		<g>
			<path fill="#646467" d="M53.596,516.482c0-0.611,0.306-0.92,0.918-0.92h5.971c0.735,0,1.224,0.309,1.47,0.92l18.647,42.137h0.275
				l18.28-42.137c0.244-0.611,0.735-0.92,1.47-0.92h5.971c0.611,0,0.918,0.309,0.918,0.92v60.721c0,0.613-0.307,0.92-0.918,0.92
				h-5.787c-0.613,0-0.919-0.307-0.919-0.92v-43.516h-0.275l-15.524,34.408c-0.307,0.735-0.858,1.104-1.653,1.104h-3.675
				c-0.858,0-1.439-0.368-1.745-1.104l-15.524-34.408h-0.275v43.516c0,0.613-0.307,0.92-0.919,0.92h-5.787
				c-0.613,0-0.918-0.307-0.918-0.92V516.482z"/>
			<path fill="#646467" d="M143.618,579.135c-5.268,0-9.723-1.227-13.366-3.68c-3.644-2.453-6.262-6.102-7.854-10.948
				c-0.307-0.92-0.567-1.87-0.781-2.852c-0.215-0.98-0.383-2.13-0.505-3.45c-0.124-1.318-0.215-2.898-0.275-4.738
				c-0.062-1.84-0.092-4.048-0.092-6.623c0-2.576,0.03-4.785,0.092-6.625c0.06-1.84,0.152-3.418,0.275-4.738
				c0.122-1.317,0.29-2.468,0.505-3.449c0.214-0.98,0.474-1.932,0.781-2.852c1.592-4.846,4.21-8.494,7.854-10.949
				c3.643-2.451,8.098-3.68,13.366-3.68c5.328,0,9.813,1.229,13.458,3.68c3.643,2.455,6.261,6.104,7.854,10.949
				c0.306,0.92,0.565,1.871,0.781,2.852c0.214,0.981,0.382,2.132,0.505,3.449c0.122,1.32,0.214,2.898,0.275,4.738
				c0.061,1.84,0.092,4.049,0.092,6.625c0,2.575-0.031,4.783-0.092,6.623c-0.062,1.84-0.153,3.42-0.275,4.738
				c-0.124,1.32-0.292,2.47-0.505,3.45c-0.215,0.981-0.475,1.932-0.781,2.852c-1.593,4.847-4.211,8.495-7.854,10.948
				C153.432,577.908,148.946,579.135,143.618,579.135z M143.618,571.499c3.491,0,6.338-0.796,8.543-2.392
				c2.205-1.595,3.796-3.895,4.777-6.9c0.184-0.552,0.352-1.242,0.505-2.07c0.152-0.828,0.306-1.854,0.459-3.082
				c0.152-1.226,0.26-2.668,0.322-4.324c0.06-1.655,0.092-3.617,0.092-5.887s-0.032-4.232-0.092-5.889
				c-0.062-1.656-0.169-3.096-0.322-4.324c-0.153-1.227-0.307-2.254-0.459-3.082c-0.154-0.828-0.322-1.518-0.505-2.07
				c-0.98-3.004-2.572-5.304-4.777-6.899c-2.205-1.595-5.052-2.392-8.543-2.392s-6.324,0.797-8.497,2.392
				c-2.174,1.596-3.752,3.896-4.731,6.899c-0.184,0.553-0.353,1.242-0.505,2.07c-0.154,0.828-0.307,1.855-0.459,3.082
				c-0.154,1.229-0.261,2.668-0.321,4.324c-0.062,1.656-0.092,3.619-0.092,5.889s0.03,4.231,0.092,5.887
				c0.06,1.656,0.167,3.099,0.321,4.324c0.152,1.229,0.306,2.254,0.459,3.082c0.152,0.828,0.321,1.519,0.505,2.07
				c0.979,3.006,2.557,5.306,4.731,6.9C137.294,570.703,140.127,571.499,143.618,571.499z"/>
			<path fill="#646467" d="M179.81,516.482c0-0.611,0.306-0.92,0.918-0.92h5.879c0.735,0,1.255,0.309,1.562,0.92l28.293,46.92h0.367
				v-46.92c0-0.611,0.306-0.92,0.918-0.92h5.788c0.611,0,0.918,0.309,0.918,0.92v60.721c0,0.613-0.307,0.92-0.918,0.92h-5.879
				c-0.735,0-1.256-0.307-1.562-0.92l-28.385-46.736h-0.275v46.736c0,0.613-0.307,0.92-0.919,0.92h-5.787
				c-0.613,0-0.918-0.307-0.918-0.92V516.482z"/>
			<path fill="#646467" d="M239.886,516.482c0-0.611,0.309-0.92,0.929-0.92h6.41c0.619,0,0.929,0.309,0.929,0.92v60.721
				c0,0.613-0.31,0.92-0.929,0.92h-6.41c-0.62,0-0.929-0.307-0.929-0.92V516.482z"/>
			<path fill="#646467" d="M277.282,578.123c-0.62,0-0.929-0.307-0.929-0.92v-53.452c0-0.368-0.184-0.552-0.551-0.552h-17.086
				c-0.613,0-0.918-0.307-0.918-0.92v-5.797c0-0.611,0.306-0.92,0.918-0.92h43.542c0.611,0,0.918,0.309,0.918,0.92v5.797
				c0,0.613-0.307,0.92-0.918,0.92h-17.086c-0.367,0-0.551,0.184-0.551,0.552v53.452c0,0.613-0.31,0.92-0.929,0.92H277.282z"/>
			<path fill="#646467" d="M333.489,579.135c-5.268,0-9.723-1.227-13.366-3.68c-3.644-2.453-6.262-6.102-7.854-10.948
				c-0.307-0.92-0.567-1.87-0.781-2.852c-0.215-0.98-0.383-2.13-0.505-3.45c-0.124-1.318-0.215-2.898-0.275-4.738
				c-0.062-1.84-0.092-4.048-0.092-6.623c0-2.576,0.03-4.785,0.092-6.625c0.06-1.84,0.152-3.418,0.275-4.738
				c0.122-1.317,0.29-2.468,0.505-3.449c0.214-0.98,0.474-1.932,0.781-2.852c1.592-4.846,4.21-8.494,7.854-10.949
				c3.643-2.451,8.098-3.68,13.366-3.68c5.328,0,9.813,1.229,13.458,3.68c3.643,2.455,6.261,6.104,7.854,10.949
				c0.306,0.92,0.565,1.871,0.781,2.852c0.214,0.981,0.382,2.132,0.505,3.449c0.122,1.32,0.214,2.898,0.275,4.738
				c0.061,1.84,0.092,4.049,0.092,6.625c0,2.575-0.031,4.783-0.092,6.623c-0.062,1.84-0.153,3.42-0.275,4.738
				c-0.124,1.32-0.292,2.47-0.505,3.45c-0.215,0.981-0.475,1.932-0.781,2.852c-1.593,4.847-4.211,8.495-7.854,10.948
				C343.302,577.908,338.817,579.135,333.489,579.135z M333.489,571.499c3.491,0,6.338-0.796,8.543-2.392
				c2.205-1.595,3.796-3.895,4.777-6.9c0.184-0.552,0.352-1.242,0.505-2.07c0.152-0.828,0.306-1.854,0.459-3.082
				c0.152-1.226,0.26-2.668,0.322-4.324c0.06-1.655,0.092-3.617,0.092-5.887s-0.032-4.232-0.092-5.889
				c-0.062-1.656-0.169-3.096-0.322-4.324c-0.153-1.227-0.307-2.254-0.459-3.082c-0.154-0.828-0.322-1.518-0.505-2.07
				c-0.98-3.004-2.572-5.304-4.777-6.899c-2.205-1.595-5.052-2.392-8.543-2.392s-6.324,0.797-8.497,2.392
				c-2.174,1.596-3.752,3.896-4.731,6.899c-0.184,0.553-0.353,1.242-0.505,2.07c-0.154,0.828-0.307,1.855-0.459,3.082
				c-0.154,1.229-0.261,2.668-0.321,4.324c-0.062,1.656-0.092,3.619-0.092,5.889s0.03,4.231,0.092,5.887
				c0.06,1.656,0.167,3.099,0.321,4.324c0.152,1.229,0.306,2.254,0.459,3.082c0.152,0.828,0.321,1.519,0.505,2.07
				c0.979,3.006,2.557,5.306,4.731,6.9C327.165,570.703,329.998,571.499,333.489,571.499z"/>
			<path fill="#646467" d="M405.886,578.123c-0.557,0-0.96-0.307-1.207-0.92l-12.45-25.576h-13.73c-0.367,0-0.551,0.184-0.551,0.553
				v25.023c0,0.613-0.31,0.92-0.929,0.92h-6.41c-0.62,0-0.929-0.307-0.929-0.92v-60.721c0-0.611,0.306-0.92,0.92-0.92h22.646
				c2.945,0,5.613,0.43,8.008,1.289c2.394,0.859,4.449,2.069,6.169,3.633c1.718,1.564,3.053,3.467,4.004,5.705
				c0.95,2.239,1.427,4.707,1.427,7.406c0,4.231-1.103,7.819-3.307,10.764c-2.205,2.943-5.206,5.029-9.002,6.256l13.32,26.404
				c0.184,0.307,0.214,0.567,0.092,0.781c-0.123,0.216-0.337,0.322-0.643,0.322H405.886z M393.053,543.991
				c3.662,0,6.499-0.904,8.513-2.714c2.014-1.809,3.021-4.37,3.021-7.682c0-3.313-1.007-5.873-3.021-7.683
				c-2.014-1.809-4.851-2.714-8.513-2.714h-14.554c-0.367,0-0.551,0.184-0.551,0.552v19.688c0,0.367,0.184,0.552,0.551,0.552
				H393.053z"/>
			<path fill="#646467" d="M448.403,516.482c0-0.611,0.309-0.92,0.929-0.92h37.652c0.612,0,0.919,0.309,0.919,0.92v5.797
				c0,0.613-0.307,0.92-0.919,0.92h-29.763c-0.367,0-0.551,0.184-0.551,0.552v19.044c0,0.368,0.184,0.553,0.551,0.553h25.262
				c0.611,0,0.918,0.307,0.918,0.92v5.795c0,0.614-0.307,0.92-0.918,0.92h-25.262c-0.367,0-0.551,0.185-0.551,0.553v25.668
				c0,0.613-0.31,0.92-0.929,0.92h-6.41c-0.62,0-0.929-0.307-0.929-0.92V516.482z"/>
			<path fill="#646467" d="M520.146,579.135c-5.268,0-9.723-1.227-13.366-3.68c-3.644-2.453-6.262-6.102-7.854-10.948
				c-0.307-0.92-0.567-1.87-0.781-2.852c-0.215-0.98-0.383-2.13-0.505-3.45c-0.124-1.318-0.215-2.898-0.275-4.738
				c-0.062-1.84-0.092-4.048-0.092-6.623c0-2.576,0.03-4.785,0.092-6.625c0.06-1.84,0.152-3.418,0.275-4.738
				c0.122-1.317,0.29-2.468,0.505-3.449c0.214-0.98,0.474-1.932,0.781-2.852c1.592-4.846,4.21-8.494,7.854-10.949
				c3.643-2.451,8.098-3.68,13.366-3.68c5.328,0,9.813,1.229,13.458,3.68c3.643,2.455,6.26,6.104,7.854,10.949
				c0.306,0.92,0.565,1.871,0.781,2.852c0.213,0.981,0.381,2.132,0.505,3.449c0.122,1.32,0.214,2.898,0.275,4.738
				c0.061,1.84,0.092,4.049,0.092,6.625c0,2.575-0.031,4.783-0.092,6.623c-0.062,1.84-0.153,3.42-0.275,4.738
				c-0.124,1.32-0.292,2.47-0.505,3.45c-0.216,0.981-0.476,1.932-0.781,2.852c-1.594,4.847-4.211,8.495-7.854,10.948
				C529.959,577.908,525.474,579.135,520.146,579.135z M520.146,571.499c3.491,0,6.339-0.796,8.543-2.392
				c2.204-1.595,3.796-3.895,4.776-6.9c0.184-0.552,0.352-1.242,0.506-2.07c0.152-0.828,0.306-1.854,0.459-3.082
				c0.152-1.226,0.26-2.668,0.322-4.324c0.06-1.655,0.092-3.617,0.092-5.887s-0.032-4.232-0.092-5.889
				c-0.063-1.656-0.17-3.096-0.322-4.324c-0.153-1.227-0.307-2.254-0.459-3.082c-0.154-0.828-0.322-1.518-0.506-2.07
				c-0.98-3.004-2.572-5.304-4.776-6.899c-2.204-1.595-5.052-2.392-8.543-2.392s-6.324,0.797-8.497,2.392
				c-2.174,1.596-3.752,3.896-4.731,6.899c-0.184,0.553-0.353,1.242-0.505,2.07c-0.154,0.828-0.307,1.855-0.459,3.082
				c-0.154,1.229-0.261,2.668-0.321,4.324c-0.062,1.656-0.092,3.619-0.092,5.889s0.03,4.231,0.092,5.887
				c0.06,1.656,0.167,3.099,0.321,4.324c0.152,1.229,0.306,2.254,0.459,3.082c0.152,0.828,0.321,1.519,0.505,2.07
				c0.979,3.006,2.557,5.306,4.731,6.9C513.821,570.703,516.654,571.499,520.146,571.499z"/>
			<path fill="#646467" d="M592.543,578.123c-0.557,0-0.96-0.307-1.207-0.92l-12.449-25.576h-13.73
				c-0.367,0-0.551,0.184-0.551,0.553v25.023c0,0.613-0.311,0.92-0.93,0.92h-6.41c-0.619,0-0.928-0.307-0.928-0.92v-60.721
				c0-0.611,0.305-0.92,0.92-0.92h22.646c2.945,0,5.613,0.43,8.008,1.289c2.394,0.859,4.449,2.069,6.168,3.633
				c1.719,1.564,3.053,3.467,4.005,5.705c0.95,2.239,1.427,4.707,1.427,7.406c0,4.231-1.103,7.819-3.307,10.764
				c-2.205,2.943-5.207,5.029-9.003,6.256l13.319,26.404c0.184,0.307,0.215,0.567,0.092,0.781c-0.123,0.216-0.336,0.322-0.643,0.322
				H592.543z M579.71,543.991c3.661,0,6.499-0.904,8.513-2.714c2.014-1.809,3.021-4.37,3.021-7.682c0-3.313-1.008-5.873-3.021-7.683
				c-2.014-1.809-4.852-2.714-8.513-2.714h-14.554c-0.367,0-0.551,0.184-0.551,0.552v19.688c0,0.367,0.184,0.552,0.551,0.552H579.71
				z"/>
			<path fill="#646467" d="M635.061,516.482c0-0.611,0.305-0.92,0.918-0.92h5.971c0.735,0,1.225,0.309,1.471,0.92l18.646,42.137
				h0.276l18.28-42.137c0.243-0.611,0.734-0.92,1.47-0.92h5.971c0.611,0,0.918,0.309,0.918,0.92v60.721
				c0,0.613-0.307,0.92-0.918,0.92h-5.787c-0.613,0-0.919-0.307-0.919-0.92v-43.516h-0.275l-15.524,34.408
				c-0.308,0.735-0.858,1.104-1.653,1.104h-3.675c-0.858,0-1.439-0.368-1.745-1.104l-15.524-34.408h-0.275v43.516
				c0,0.613-0.308,0.92-0.919,0.92h-5.787c-0.613,0-0.918-0.307-0.918-0.92V516.482z"/>
			<path fill="#646467" d="M720.581,516.482c0.184-0.611,0.551-0.92,1.103-0.92h5.971c0.611,0,1.011,0.309,1.194,0.92l21.403,60.721
				c0.184,0.613-0.032,0.92-0.644,0.92h-6.43c-0.613,0-1.011-0.307-1.194-0.92l-4.776-13.616h-25.262l-4.777,13.616
				c-0.245,0.613-0.643,0.92-1.193,0.92h-6.431c-0.613,0-0.827-0.307-0.643-0.92L720.581,516.482z M734.544,556.043l-9.829-28.428
				h-0.184l-9.921,28.428H734.544z"/>
			<path fill="#646467" d="M759.621,564.507c-0.307-0.92-0.551-1.87-0.734-2.852c-0.185-0.98-0.354-2.13-0.506-3.45
				c-0.153-1.318-0.261-2.898-0.321-4.738c-0.062-1.84-0.092-4.048-0.092-6.623c0-2.576,0.03-4.785,0.092-6.625
				c0.061-1.84,0.168-3.418,0.321-4.738c0.152-1.317,0.321-2.468,0.506-3.449c0.184-0.98,0.428-1.932,0.734-2.852
				c1.592-4.846,4.226-8.494,7.9-10.949c3.674-2.451,8.175-3.68,13.503-3.68c2.756,0,5.236,0.322,7.44,0.967
				c2.205,0.644,4.164,1.533,5.88,2.668c1.713,1.135,3.183,2.453,4.409,3.955c1.224,1.504,2.234,3.114,3.031,4.83
				c0.306,0.553,0.214,0.982-0.275,1.289l-5.512,2.668c-0.552,0.307-0.98,0.153-1.286-0.461c-1.531-2.82-3.369-4.906-5.512-6.256
				c-2.145-1.348-4.869-2.023-8.176-2.023c-3.553,0-6.446,0.797-8.681,2.392c-2.236,1.596-3.844,3.896-4.822,6.899
				c-0.185,0.553-0.368,1.229-0.552,2.024c-0.184,0.798-0.321,1.78-0.413,2.944c-0.092,1.166-0.169,2.592-0.229,4.277
				c-0.062,1.688-0.092,3.727-0.092,6.119c0,2.391,0.03,4.432,0.092,6.117c0.061,1.688,0.136,3.113,0.228,4.278
				c0.093,1.165,0.229,2.147,0.412,2.944s0.366,1.472,0.55,2.023c0.977,3.006,2.579,5.306,4.807,6.9
				c2.229,1.596,5.113,2.392,8.655,2.392c3.174,0,5.951-0.767,8.332-2.3s4.061-3.771,5.038-6.717
				c0.305-1.041,0.58-2.359,0.824-3.955c0.243-1.595,0.365-3.557,0.365-5.889c0-0.367-0.182-0.552-0.547-0.552h-12.043
				c-0.609,0-0.913-0.306-0.913-0.92v-5.336c0-0.612,0.306-0.92,0.919-0.92h19.934c0.611,0,0.918,0.308,0.918,0.92v4.692
				c0,2.821-0.138,5.443-0.413,7.865c-0.275,2.424-0.659,4.402-1.148,5.935c-1.531,4.784-4.149,8.449-7.854,10.993
				c-3.706,2.547-8.161,3.818-13.366,3.818c-5.328,0-9.829-1.227-13.503-3.68C763.847,573.002,761.213,569.354,759.621,564.507z"/>
			<path fill="#646467" d="M817.032,516.482c0-0.611,0.307-0.92,0.919-0.92h5.879c0.735,0,1.255,0.309,1.562,0.92l28.293,46.92
				h0.368v-46.92c0-0.611,0.306-0.92,0.918-0.92h5.787c0.611,0,0.919,0.309,0.919,0.92v60.721c0,0.613-0.308,0.92-0.919,0.92h-5.879
				c-0.734,0-1.256-0.307-1.562-0.92l-28.385-46.736h-0.275v46.736c0,0.613-0.308,0.92-0.919,0.92h-5.787
				c-0.612,0-0.919-0.307-0.919-0.92V516.482z"/>
			<path fill="#646467" d="M877.107,516.482c0-0.611,0.309-0.92,0.929-0.92h37.653c0.611,0,0.918,0.309,0.918,0.92v5.797
				c0,0.613-0.307,0.92-0.918,0.92h-29.763c-0.368,0-0.552,0.184-0.552,0.552v18.399c0,0.369,0.184,0.553,0.552,0.553h25.261
				c0.612,0,0.919,0.308,0.919,0.92v5.796c0,0.614-0.307,0.92-0.919,0.92h-25.261c-0.368,0-0.552,0.185-0.552,0.552v19.045
				c0,0.367,0.184,0.551,0.552,0.551h29.763c0.611,0,0.918,0.309,0.918,0.921v5.796c0,0.613-0.307,0.92-0.918,0.92h-37.653
				c-0.62,0-0.929-0.307-0.929-0.92V516.482z"/>
			<path fill="#646467" d="M942.613,578.123c-0.619,0-0.928-0.307-0.928-0.92v-53.452c0-0.368-0.185-0.552-0.552-0.552h-17.086
				c-0.613,0-0.919-0.307-0.919-0.92v-5.797c0-0.611,0.306-0.92,0.919-0.92h43.542c0.611,0,0.918,0.309,0.918,0.92v5.797
				c0,0.613-0.307,0.92-0.918,0.92h-17.086c-0.368,0-0.552,0.184-0.552,0.552v53.452c0,0.613-0.31,0.92-0.929,0.92H942.613z"/>
		</g>
		<g>
			<path fill="none" stroke="#646467" stroke-width="3" d="M53.596,516.482c0-0.611,0.306-0.92,0.918-0.92h5.971
				c0.735,0,1.224,0.309,1.47,0.92l18.647,42.137h0.275l18.28-42.137c0.244-0.611,0.735-0.92,1.47-0.92h5.971
				c0.611,0,0.918,0.309,0.918,0.92v60.721c0,0.613-0.307,0.92-0.918,0.92h-5.787c-0.613,0-0.919-0.307-0.919-0.92v-43.516h-0.275
				l-15.524,34.408c-0.307,0.735-0.858,1.104-1.653,1.104h-3.675c-0.858,0-1.439-0.368-1.745-1.104l-15.524-34.408h-0.275v43.516
				c0,0.613-0.307,0.92-0.919,0.92h-5.787c-0.613,0-0.918-0.307-0.918-0.92V516.482z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M143.618,579.135c-5.268,0-9.723-1.227-13.366-3.68
				c-3.644-2.453-6.262-6.102-7.854-10.948c-0.307-0.92-0.567-1.87-0.781-2.852c-0.215-0.98-0.383-2.13-0.505-3.45
				c-0.124-1.318-0.215-2.898-0.275-4.738c-0.062-1.84-0.092-4.048-0.092-6.623c0-2.576,0.03-4.785,0.092-6.625
				c0.06-1.84,0.152-3.418,0.275-4.738c0.122-1.317,0.29-2.468,0.505-3.449c0.214-0.98,0.474-1.932,0.781-2.852
				c1.592-4.846,4.21-8.494,7.854-10.949c3.643-2.451,8.098-3.68,13.366-3.68c5.328,0,9.813,1.229,13.458,3.68
				c3.643,2.455,6.261,6.104,7.854,10.949c0.306,0.92,0.565,1.871,0.781,2.852c0.214,0.981,0.382,2.132,0.505,3.449
				c0.122,1.32,0.214,2.898,0.275,4.738c0.061,1.84,0.092,4.049,0.092,6.625c0,2.575-0.031,4.783-0.092,6.623
				c-0.062,1.84-0.153,3.42-0.275,4.738c-0.124,1.32-0.292,2.47-0.505,3.45c-0.215,0.981-0.475,1.932-0.781,2.852
				c-1.593,4.847-4.211,8.495-7.854,10.948C153.432,577.908,148.946,579.135,143.618,579.135z M143.618,571.499
				c3.491,0,6.338-0.796,8.543-2.392c2.205-1.595,3.796-3.895,4.777-6.9c0.184-0.552,0.352-1.242,0.505-2.07
				c0.152-0.828,0.306-1.854,0.459-3.082c0.152-1.226,0.26-2.668,0.322-4.324c0.06-1.655,0.092-3.617,0.092-5.887
				s-0.032-4.232-0.092-5.889c-0.062-1.656-0.169-3.096-0.322-4.324c-0.153-1.227-0.307-2.254-0.459-3.082
				c-0.154-0.828-0.322-1.518-0.505-2.07c-0.98-3.004-2.572-5.304-4.777-6.899c-2.205-1.595-5.052-2.392-8.543-2.392
				s-6.324,0.797-8.497,2.392c-2.174,1.596-3.752,3.896-4.731,6.899c-0.184,0.553-0.353,1.242-0.505,2.07
				c-0.154,0.828-0.307,1.855-0.459,3.082c-0.154,1.229-0.261,2.668-0.321,4.324c-0.062,1.656-0.092,3.619-0.092,5.889
				s0.03,4.231,0.092,5.887c0.06,1.656,0.167,3.099,0.321,4.324c0.152,1.229,0.306,2.254,0.459,3.082
				c0.152,0.828,0.321,1.519,0.505,2.07c0.979,3.006,2.557,5.306,4.731,6.9C137.294,570.703,140.127,571.499,143.618,571.499z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M179.81,516.482c0-0.611,0.306-0.92,0.918-0.92h5.879
				c0.735,0,1.255,0.309,1.562,0.92l28.293,46.92h0.367v-46.92c0-0.611,0.306-0.92,0.918-0.92h5.788c0.611,0,0.918,0.309,0.918,0.92
				v60.721c0,0.613-0.307,0.92-0.918,0.92h-5.879c-0.735,0-1.256-0.307-1.562-0.92l-28.385-46.736h-0.275v46.736
				c0,0.613-0.307,0.92-0.919,0.92h-5.787c-0.613,0-0.918-0.307-0.918-0.92V516.482z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M239.886,516.482c0-0.611,0.309-0.92,0.929-0.92h6.41
				c0.619,0,0.929,0.309,0.929,0.92v60.721c0,0.613-0.31,0.92-0.929,0.92h-6.41c-0.62,0-0.929-0.307-0.929-0.92V516.482z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M277.282,578.123c-0.62,0-0.929-0.307-0.929-0.92v-53.452
				c0-0.368-0.184-0.552-0.551-0.552h-17.086c-0.613,0-0.918-0.307-0.918-0.92v-5.797c0-0.611,0.306-0.92,0.918-0.92h43.542
				c0.611,0,0.918,0.309,0.918,0.92v5.797c0,0.613-0.307,0.92-0.918,0.92h-17.086c-0.367,0-0.551,0.184-0.551,0.552v53.452
				c0,0.613-0.31,0.92-0.929,0.92H277.282z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M333.489,579.135c-5.268,0-9.723-1.227-13.366-3.68
				c-3.644-2.453-6.262-6.102-7.854-10.948c-0.307-0.92-0.567-1.87-0.781-2.852c-0.215-0.98-0.383-2.13-0.505-3.45
				c-0.124-1.318-0.215-2.898-0.275-4.738c-0.062-1.84-0.092-4.048-0.092-6.623c0-2.576,0.03-4.785,0.092-6.625
				c0.06-1.84,0.152-3.418,0.275-4.738c0.122-1.317,0.29-2.468,0.505-3.449c0.214-0.98,0.474-1.932,0.781-2.852
				c1.592-4.846,4.21-8.494,7.854-10.949c3.643-2.451,8.098-3.68,13.366-3.68c5.328,0,9.813,1.229,13.458,3.68
				c3.643,2.455,6.261,6.104,7.854,10.949c0.306,0.92,0.565,1.871,0.781,2.852c0.214,0.981,0.382,2.132,0.505,3.449
				c0.122,1.32,0.214,2.898,0.275,4.738c0.061,1.84,0.092,4.049,0.092,6.625c0,2.575-0.031,4.783-0.092,6.623
				c-0.062,1.84-0.153,3.42-0.275,4.738c-0.124,1.32-0.292,2.47-0.505,3.45c-0.215,0.981-0.475,1.932-0.781,2.852
				c-1.593,4.847-4.211,8.495-7.854,10.948C343.302,577.908,338.817,579.135,333.489,579.135z M333.489,571.499
				c3.491,0,6.338-0.796,8.543-2.392c2.205-1.595,3.796-3.895,4.777-6.9c0.184-0.552,0.352-1.242,0.505-2.07
				c0.152-0.828,0.306-1.854,0.459-3.082c0.152-1.226,0.26-2.668,0.322-4.324c0.06-1.655,0.092-3.617,0.092-5.887
				s-0.032-4.232-0.092-5.889c-0.062-1.656-0.169-3.096-0.322-4.324c-0.153-1.227-0.307-2.254-0.459-3.082
				c-0.154-0.828-0.322-1.518-0.505-2.07c-0.98-3.004-2.572-5.304-4.777-6.899c-2.205-1.595-5.052-2.392-8.543-2.392
				s-6.324,0.797-8.497,2.392c-2.174,1.596-3.752,3.896-4.731,6.899c-0.184,0.553-0.353,1.242-0.505,2.07
				c-0.154,0.828-0.307,1.855-0.459,3.082c-0.154,1.229-0.261,2.668-0.321,4.324c-0.062,1.656-0.092,3.619-0.092,5.889
				s0.03,4.231,0.092,5.887c0.06,1.656,0.167,3.099,0.321,4.324c0.152,1.229,0.306,2.254,0.459,3.082
				c0.152,0.828,0.321,1.519,0.505,2.07c0.979,3.006,2.557,5.306,4.731,6.9C327.165,570.703,329.998,571.499,333.489,571.499z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M405.886,578.123c-0.557,0-0.96-0.307-1.207-0.92l-12.45-25.576h-13.73
				c-0.367,0-0.551,0.184-0.551,0.553v25.023c0,0.613-0.31,0.92-0.929,0.92h-6.41c-0.62,0-0.929-0.307-0.929-0.92v-60.721
				c0-0.611,0.306-0.92,0.92-0.92h22.646c2.945,0,5.613,0.43,8.008,1.289c2.394,0.859,4.449,2.069,6.169,3.633
				c1.718,1.564,3.053,3.467,4.004,5.705c0.95,2.239,1.427,4.707,1.427,7.406c0,4.231-1.103,7.819-3.307,10.764
				c-2.205,2.943-5.206,5.029-9.002,6.256l13.32,26.404c0.184,0.307,0.214,0.567,0.092,0.781c-0.123,0.216-0.337,0.322-0.643,0.322
				H405.886z M393.053,543.991c3.662,0,6.499-0.904,8.513-2.714c2.014-1.809,3.021-4.37,3.021-7.682
				c0-3.313-1.007-5.873-3.021-7.683c-2.014-1.809-4.851-2.714-8.513-2.714h-14.554c-0.367,0-0.551,0.184-0.551,0.552v19.688
				c0,0.367,0.184,0.552,0.551,0.552H393.053z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M448.403,516.482c0-0.611,0.309-0.92,0.929-0.92h37.652
				c0.612,0,0.919,0.309,0.919,0.92v5.797c0,0.613-0.307,0.92-0.919,0.92h-29.763c-0.367,0-0.551,0.184-0.551,0.552v19.044
				c0,0.368,0.184,0.553,0.551,0.553h25.262c0.611,0,0.918,0.307,0.918,0.92v5.795c0,0.614-0.307,0.92-0.918,0.92h-25.262
				c-0.367,0-0.551,0.185-0.551,0.553v25.668c0,0.613-0.31,0.92-0.929,0.92h-6.41c-0.62,0-0.929-0.307-0.929-0.92V516.482z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M520.146,579.135c-5.268,0-9.723-1.227-13.366-3.68
				c-3.644-2.453-6.262-6.102-7.854-10.948c-0.307-0.92-0.567-1.87-0.781-2.852c-0.215-0.98-0.383-2.13-0.505-3.45
				c-0.124-1.318-0.215-2.898-0.275-4.738c-0.062-1.84-0.092-4.048-0.092-6.623c0-2.576,0.03-4.785,0.092-6.625
				c0.06-1.84,0.152-3.418,0.275-4.738c0.122-1.317,0.29-2.468,0.505-3.449c0.214-0.98,0.474-1.932,0.781-2.852
				c1.592-4.846,4.21-8.494,7.854-10.949c3.643-2.451,8.098-3.68,13.366-3.68c5.328,0,9.813,1.229,13.458,3.68
				c3.643,2.455,6.26,6.104,7.854,10.949c0.306,0.92,0.565,1.871,0.781,2.852c0.213,0.981,0.381,2.132,0.505,3.449
				c0.122,1.32,0.214,2.898,0.275,4.738c0.061,1.84,0.092,4.049,0.092,6.625c0,2.575-0.031,4.783-0.092,6.623
				c-0.062,1.84-0.153,3.42-0.275,4.738c-0.124,1.32-0.292,2.47-0.505,3.45c-0.216,0.981-0.476,1.932-0.781,2.852
				c-1.594,4.847-4.211,8.495-7.854,10.948C529.959,577.908,525.474,579.135,520.146,579.135z M520.146,571.499
				c3.491,0,6.339-0.796,8.543-2.392c2.204-1.595,3.796-3.895,4.776-6.9c0.184-0.552,0.352-1.242,0.506-2.07
				c0.152-0.828,0.306-1.854,0.459-3.082c0.152-1.226,0.26-2.668,0.322-4.324c0.06-1.655,0.092-3.617,0.092-5.887
				s-0.032-4.232-0.092-5.889c-0.063-1.656-0.17-3.096-0.322-4.324c-0.153-1.227-0.307-2.254-0.459-3.082
				c-0.154-0.828-0.322-1.518-0.506-2.07c-0.98-3.004-2.572-5.304-4.776-6.899c-2.204-1.595-5.052-2.392-8.543-2.392
				s-6.324,0.797-8.497,2.392c-2.174,1.596-3.752,3.896-4.731,6.899c-0.184,0.553-0.353,1.242-0.505,2.07
				c-0.154,0.828-0.307,1.855-0.459,3.082c-0.154,1.229-0.261,2.668-0.321,4.324c-0.062,1.656-0.092,3.619-0.092,5.889
				s0.03,4.231,0.092,5.887c0.06,1.656,0.167,3.099,0.321,4.324c0.152,1.229,0.306,2.254,0.459,3.082
				c0.152,0.828,0.321,1.519,0.505,2.07c0.979,3.006,2.557,5.306,4.731,6.9C513.821,570.703,516.654,571.499,520.146,571.499z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M592.543,578.123c-0.557,0-0.96-0.307-1.207-0.92l-12.449-25.576h-13.73
				c-0.367,0-0.551,0.184-0.551,0.553v25.023c0,0.613-0.311,0.92-0.93,0.92h-6.41c-0.619,0-0.928-0.307-0.928-0.92v-60.721
				c0-0.611,0.305-0.92,0.92-0.92h22.646c2.945,0,5.613,0.43,8.008,1.289c2.394,0.859,4.449,2.069,6.168,3.633
				c1.719,1.564,3.053,3.467,4.005,5.705c0.95,2.239,1.427,4.707,1.427,7.406c0,4.231-1.103,7.819-3.307,10.764
				c-2.205,2.943-5.207,5.029-9.003,6.256l13.319,26.404c0.184,0.307,0.215,0.567,0.092,0.781c-0.123,0.216-0.336,0.322-0.643,0.322
				H592.543z M579.71,543.991c3.661,0,6.499-0.904,8.513-2.714c2.014-1.809,3.021-4.37,3.021-7.682c0-3.313-1.008-5.873-3.021-7.683
				c-2.014-1.809-4.852-2.714-8.513-2.714h-14.554c-0.367,0-0.551,0.184-0.551,0.552v19.688c0,0.367,0.184,0.552,0.551,0.552H579.71
				z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M635.061,516.482c0-0.611,0.305-0.92,0.918-0.92h5.971
				c0.735,0,1.225,0.309,1.471,0.92l18.646,42.137h0.276l18.28-42.137c0.243-0.611,0.734-0.92,1.47-0.92h5.971
				c0.611,0,0.918,0.309,0.918,0.92v60.721c0,0.613-0.307,0.92-0.918,0.92h-5.787c-0.613,0-0.919-0.307-0.919-0.92v-43.516h-0.275
				l-15.524,34.408c-0.308,0.735-0.858,1.104-1.653,1.104h-3.675c-0.858,0-1.439-0.368-1.745-1.104l-15.524-34.408h-0.275v43.516
				c0,0.613-0.308,0.92-0.919,0.92h-5.787c-0.613,0-0.918-0.307-0.918-0.92V516.482z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M720.581,516.482c0.184-0.611,0.551-0.92,1.103-0.92h5.971
				c0.611,0,1.011,0.309,1.194,0.92l21.403,60.721c0.184,0.613-0.032,0.92-0.644,0.92h-6.43c-0.613,0-1.011-0.307-1.194-0.92
				l-4.776-13.616h-25.262l-4.777,13.616c-0.245,0.613-0.643,0.92-1.193,0.92h-6.431c-0.613,0-0.827-0.307-0.643-0.92
				L720.581,516.482z M734.544,556.043l-9.829-28.428h-0.184l-9.921,28.428H734.544z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M759.621,564.507c-0.307-0.92-0.551-1.87-0.734-2.852
				c-0.185-0.98-0.354-2.13-0.506-3.45c-0.153-1.318-0.261-2.898-0.321-4.738c-0.062-1.84-0.092-4.048-0.092-6.623
				c0-2.576,0.03-4.785,0.092-6.625c0.061-1.84,0.168-3.418,0.321-4.738c0.152-1.317,0.321-2.468,0.506-3.449
				c0.184-0.98,0.428-1.932,0.734-2.852c1.592-4.846,4.226-8.494,7.9-10.949c3.674-2.451,8.175-3.68,13.503-3.68
				c2.756,0,5.236,0.322,7.44,0.967c2.205,0.644,4.164,1.533,5.88,2.668c1.713,1.135,3.183,2.453,4.409,3.955
				c1.224,1.504,2.234,3.114,3.031,4.83c0.306,0.553,0.214,0.982-0.275,1.289l-5.512,2.668c-0.552,0.307-0.98,0.153-1.286-0.461
				c-1.531-2.82-3.369-4.906-5.512-6.256c-2.145-1.348-4.869-2.023-8.176-2.023c-3.553,0-6.446,0.797-8.681,2.392
				c-2.236,1.596-3.844,3.896-4.822,6.899c-0.185,0.553-0.368,1.229-0.552,2.024c-0.184,0.798-0.321,1.78-0.413,2.944
				c-0.092,1.166-0.169,2.592-0.229,4.277c-0.062,1.688-0.092,3.727-0.092,6.119c0,2.391,0.03,4.432,0.092,6.117
				c0.061,1.688,0.136,3.113,0.228,4.278c0.093,1.165,0.229,2.147,0.412,2.944s0.366,1.472,0.55,2.023
				c0.977,3.006,2.579,5.306,4.807,6.9c2.229,1.596,5.113,2.392,8.655,2.392c3.174,0,5.951-0.767,8.332-2.3s4.061-3.771,5.038-6.717
				c0.305-1.041,0.58-2.359,0.824-3.955c0.243-1.595,0.365-3.557,0.365-5.889c0-0.367-0.182-0.552-0.547-0.552h-12.043
				c-0.609,0-0.913-0.306-0.913-0.92v-5.336c0-0.612,0.306-0.92,0.919-0.92h19.934c0.611,0,0.918,0.308,0.918,0.92v4.692
				c0,2.821-0.138,5.443-0.413,7.865c-0.275,2.424-0.659,4.402-1.148,5.935c-1.531,4.784-4.149,8.449-7.854,10.993
				c-3.706,2.547-8.161,3.818-13.366,3.818c-5.328,0-9.829-1.227-13.503-3.68C763.847,573.002,761.213,569.354,759.621,564.507z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M817.032,516.482c0-0.611,0.307-0.92,0.919-0.92h5.879
				c0.735,0,1.255,0.309,1.562,0.92l28.293,46.92h0.368v-46.92c0-0.611,0.306-0.92,0.918-0.92h5.787c0.611,0,0.919,0.309,0.919,0.92
				v60.721c0,0.613-0.308,0.92-0.919,0.92h-5.879c-0.734,0-1.256-0.307-1.562-0.92l-28.385-46.736h-0.275v46.736
				c0,0.613-0.308,0.92-0.919,0.92h-5.787c-0.612,0-0.919-0.307-0.919-0.92V516.482z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M877.107,516.482c0-0.611,0.309-0.92,0.929-0.92h37.653
				c0.611,0,0.918,0.309,0.918,0.92v5.797c0,0.613-0.307,0.92-0.918,0.92h-29.763c-0.368,0-0.552,0.184-0.552,0.552v18.399
				c0,0.369,0.184,0.553,0.552,0.553h25.261c0.612,0,0.919,0.308,0.919,0.92v5.796c0,0.614-0.307,0.92-0.919,0.92h-25.261
				c-0.368,0-0.552,0.185-0.552,0.552v19.045c0,0.367,0.184,0.551,0.552,0.551h29.763c0.611,0,0.918,0.309,0.918,0.921v5.796
				c0,0.613-0.307,0.92-0.918,0.92h-37.653c-0.62,0-0.929-0.307-0.929-0.92V516.482z"/>
			<path fill="none" stroke="#646467" stroke-width="3" d="M942.613,578.123c-0.619,0-0.928-0.307-0.928-0.92v-53.452
				c0-0.368-0.185-0.552-0.552-0.552h-17.086c-0.613,0-0.919-0.307-0.919-0.92v-5.797c0-0.611,0.306-0.92,0.919-0.92h43.542
				c0.611,0,0.918,0.309,0.918,0.92v5.797c0,0.613-0.307,0.92-0.918,0.92h-17.086c-0.368,0-0.552,0.184-0.552,0.552v53.452
				c0,0.613-0.31,0.92-0.929,0.92H942.613z"/>
		</g>
	</g>
	<g>
		<g>
			<g>
				<g>
					<path fill="none" stroke="#C8C5C2" stroke-width="20" d="M424.905,381.762c-7.169,0-12.176-5.162-12.176-12.553V268.206
						c0-11.914-2.29-21.045-6.807-27.139c-2.521-3.398-7.225-7.924-18.828-7.924c-7.723,0-13.878,2.725-18.819,8.332
						c-5.238,5.939-7.783,14.093-7.783,24.928v102.807c0,7.391-5.008,12.553-12.178,12.553h-20.683
						c-7.17,0-12.177-5.162-12.177-12.553V268.206c0-11.914-2.29-21.045-6.806-27.139c-2.522-3.398-7.225-7.924-18.829-7.924
						c-8.019,0-14.035,2.631-18.933,8.278c-5.162,5.946-7.67,14.117-7.67,24.981v102.807c0,7.391-5.008,12.553-12.178,12.553
						h-20.682c-7.17,0-12.178-5.162-12.178-12.553V203.636c0-7.39,5.008-12.552,12.178-12.552h20.682
						c5.056,0,9.117,2.709,11.015,6.921c1.396-1.018,2.854-1.989,4.376-2.915c8.714-5.292,19.302-7.975,31.47-7.975
						c12.181,0,22.94,2.811,31.981,8.353c5.382,3.301,10.089,7.446,14.084,12.394c4.475-4.834,9.531-8.94,15.121-12.271
						c9.451-5.625,21.048-8.475,34.472-8.475c20.873,0,37.091,7.083,48.204,21.052c10.618,13.354,16.003,31.126,16.003,52.824
						v108.218c0,7.391-5.008,12.553-12.177,12.553H424.905z"/>
				</g>
				<g>
					<path fill="none" stroke="#C8C5C2" stroke-width="20" d="M424.905,381.762c-7.169,0-12.176-5.162-12.176-12.553V268.206
						c0-11.914-2.29-21.045-6.807-27.139c-2.521-3.398-7.225-7.924-18.828-7.924c-7.723,0-13.878,2.725-18.819,8.332
						c-5.238,5.939-7.783,14.093-7.783,24.928v102.807c0,7.391-5.008,12.553-12.178,12.553h-20.683
						c-7.17,0-12.177-5.162-12.177-12.553V268.206c0-11.914-2.29-21.045-6.806-27.139c-2.522-3.398-7.225-7.924-18.829-7.924
						c-8.019,0-14.035,2.631-18.933,8.278c-5.162,5.946-7.67,14.117-7.67,24.981v102.807c0,7.391-5.008,12.553-12.178,12.553
						h-20.682c-7.17,0-12.178-5.162-12.178-12.553V203.636c0-7.39,5.008-12.552,12.178-12.552h20.682
						c5.056,0,9.117,2.709,11.015,6.921c1.396-1.018,2.854-1.989,4.376-2.915c8.714-5.292,19.302-7.975,31.47-7.975
						c12.181,0,22.94,2.811,31.981,8.353c5.382,3.301,10.089,7.446,14.084,12.394c4.475-4.834,9.531-8.94,15.121-12.271
						c9.451-5.625,21.048-8.475,34.472-8.475c20.873,0,37.091,7.083,48.204,21.052c10.618,13.354,16.003,31.126,16.003,52.824
						v108.218c0,7.391-5.008,12.553-12.177,12.553H424.905z"/>
				</g>
				<g>
					<path fill="none" stroke="#C8C5C2" stroke-width="20" d="M424.905,381.762c-7.169,0-12.176-5.162-12.176-12.553V268.206
						c0-11.914-2.29-21.045-6.807-27.139c-2.521-3.398-7.225-7.924-18.828-7.924c-7.723,0-13.878,2.725-18.819,8.332
						c-5.238,5.939-7.783,14.093-7.783,24.928v102.807c0,7.391-5.008,12.553-12.178,12.553h-20.683
						c-7.17,0-12.177-5.162-12.177-12.553V268.206c0-11.914-2.29-21.045-6.806-27.139c-2.522-3.398-7.225-7.924-18.829-7.924
						c-8.019,0-14.035,2.631-18.933,8.278c-5.162,5.946-7.67,14.117-7.67,24.981v102.807c0,7.391-5.008,12.553-12.178,12.553
						h-20.682c-7.17,0-12.178-5.162-12.178-12.553V203.636c0-7.39,5.008-12.552,12.178-12.552h20.682
						c5.056,0,9.117,2.709,11.015,6.921c1.396-1.018,2.854-1.989,4.376-2.915c8.714-5.292,19.302-7.975,31.47-7.975
						c12.181,0,22.94,2.811,31.981,8.353c5.382,3.301,10.089,7.446,14.084,12.394c4.475-4.834,9.531-8.94,15.121-12.271
						c9.451-5.625,21.048-8.475,34.472-8.475c20.873,0,37.091,7.083,48.204,21.052c10.618,13.354,16.003,31.126,16.003,52.824
						v108.218c0,7.391-5.008,12.553-12.177,12.553H424.905z"/>
				</g>
			</g>
			<g>
				<path fill="none" stroke="#C8C5C2" stroke-width="20" d="M589.939,255.57h-6.667H475.989l40.443-69.797H460.89l-73.084,125.159
					h30.229h24.325h42.451v70.173h55.358v-70.173l41.771,0.005c0.175,0.005-4.18,0.001-4-0.004l8,0
					c14.725-0.62,23.333-12.617,23.333-27.495C609.272,268.556,604.666,256.186,589.939,255.57z"/>
			</g>
			<g>
				<g>
					<path fill="none" stroke="#C8C5C2" stroke-width="20" d="M772.96,381.357c-7.169,0-12.176-5.162-12.176-12.553V267.802
						c0-11.914-2.29-21.045-6.807-27.14c-2.521-3.398-7.225-7.923-18.828-7.923c-7.723,0-13.878,2.725-18.819,8.332
						c-5.238,5.939-7.783,14.093-7.783,24.928v102.806c0,7.391-5.008,12.553-12.178,12.553h-20.683
						c-7.17,0-12.177-5.162-12.177-12.553V267.802c0-11.915-2.29-21.046-6.806-27.139c-2.522-3.398-7.225-7.924-18.829-7.924
						c-8.019,0-14.035,2.63-18.933,8.278c-5.162,5.947-7.67,14.117-7.67,24.981v102.806c0,7.391-5.008,12.553-12.178,12.553h-20.682
						c-7.17,0-12.178-5.162-12.178-12.553V203.232c0-7.39,5.008-12.552,12.178-12.552h20.682c5.056,0,9.117,2.709,11.015,6.921
						c1.396-1.018,2.854-1.989,4.376-2.915c8.714-5.292,19.302-7.975,31.47-7.975c12.181,0,22.94,2.811,31.981,8.353
						c5.382,3.301,10.089,7.447,14.084,12.394c4.475-4.835,9.531-8.941,15.121-12.271c9.451-5.625,21.048-8.475,34.472-8.475
						c20.873,0,37.091,7.083,48.204,21.052c10.618,13.354,16.003,31.126,16.003,52.824v108.217c0,7.391-5.008,12.553-12.177,12.553
						H772.96z"/>
				</g>
				<g>
					<path fill="none" stroke="#C8C5C2" stroke-width="20" d="M772.96,381.357c-7.169,0-12.176-5.162-12.176-12.553V267.802
						c0-11.914-2.29-21.045-6.807-27.14c-2.521-3.398-7.225-7.923-18.828-7.923c-7.723,0-13.878,2.725-18.819,8.332
						c-5.238,5.939-7.783,14.093-7.783,24.928v102.806c0,7.391-5.008,12.553-12.178,12.553h-20.683
						c-7.17,0-12.177-5.162-12.177-12.553V267.802c0-11.915-2.29-21.046-6.806-27.139c-2.522-3.398-7.225-7.924-18.829-7.924
						c-8.019,0-14.035,2.63-18.933,8.278c-5.162,5.947-7.67,14.117-7.67,24.981v102.806c0,7.391-5.008,12.553-12.178,12.553h-20.682
						c-7.17,0-12.178-5.162-12.178-12.553V203.232c0-7.39,5.008-12.552,12.178-12.552h20.682c5.056,0,9.117,2.709,11.015,6.921
						c1.396-1.018,2.854-1.989,4.376-2.915c8.714-5.292,19.302-7.975,31.47-7.975c12.181,0,22.94,2.811,31.981,8.353
						c5.382,3.301,10.089,7.447,14.084,12.394c4.475-4.835,9.531-8.941,15.121-12.271c9.451-5.625,21.048-8.475,34.472-8.475
						c20.873,0,37.091,7.083,48.204,21.052c10.618,13.354,16.003,31.126,16.003,52.824v108.217c0,7.391-5.008,12.553-12.177,12.553
						H772.96z"/>
				</g>
				<g>
					<path fill="none" stroke="#C8C5C2" stroke-width="20" d="M772.96,381.357c-7.169,0-12.176-5.162-12.176-12.553V267.802
						c0-11.914-2.29-21.045-6.807-27.14c-2.521-3.398-7.225-7.923-18.828-7.923c-7.723,0-13.878,2.725-18.819,8.332
						c-5.238,5.939-7.783,14.093-7.783,24.928v102.806c0,7.391-5.008,12.553-12.178,12.553h-20.683
						c-7.17,0-12.177-5.162-12.177-12.553V267.802c0-11.915-2.29-21.046-6.806-27.139c-2.522-3.398-7.225-7.924-18.829-7.924
						c-8.019,0-14.035,2.63-18.933,8.278c-5.162,5.947-7.67,14.117-7.67,24.981v102.806c0,7.391-5.008,12.553-12.178,12.553h-20.682
						c-7.17,0-12.178-5.162-12.178-12.553V203.232c0-7.39,5.008-12.552,12.178-12.552h20.682c5.056,0,9.117,2.709,11.015,6.921
						c1.396-1.018,2.854-1.989,4.376-2.915c8.714-5.292,19.302-7.975,31.47-7.975c12.181,0,22.94,2.811,31.981,8.353
						c5.382,3.301,10.089,7.447,14.084,12.394c4.475-4.835,9.531-8.941,15.121-12.271c9.451-5.625,21.048-8.475,34.472-8.475
						c20.873,0,37.091,7.083,48.204,21.052c10.618,13.354,16.003,31.126,16.003,52.824v108.217c0,7.391-5.008,12.553-12.177,12.553
						H772.96z"/>
				</g>
			</g>
		</g>
		<g>
			<g>
				<g>
					<path fill="#646467" d="M424.905,381.762c-7.169,0-12.176-5.162-12.176-12.553V268.206c0-11.914-2.29-21.045-6.807-27.139
						c-2.521-3.398-7.225-7.924-18.828-7.924c-7.723,0-13.878,2.725-18.819,8.332c-5.238,5.939-7.783,14.093-7.783,24.928v102.807
						c0,7.391-5.008,12.553-12.178,12.553h-20.683c-7.17,0-12.177-5.162-12.177-12.553V268.206c0-11.914-2.29-21.045-6.806-27.139
						c-2.522-3.398-7.225-7.924-18.829-7.924c-8.019,0-14.035,2.631-18.933,8.278c-5.162,5.946-7.67,14.117-7.67,24.981v102.807
						c0,7.391-5.008,12.553-12.178,12.553h-20.682c-7.17,0-12.178-5.162-12.178-12.553V203.636c0-7.39,5.008-12.552,12.178-12.552
						h20.682c5.056,0,9.117,2.709,11.015,6.921c1.396-1.018,2.854-1.989,4.376-2.915c8.714-5.292,19.302-7.975,31.47-7.975
						c12.181,0,22.94,2.811,31.981,8.353c5.382,3.301,10.089,7.446,14.084,12.394c4.475-4.834,9.531-8.94,15.121-12.271
						c9.451-5.625,21.048-8.475,34.472-8.475c20.873,0,37.091,7.083,48.204,21.052c10.618,13.354,16.003,31.126,16.003,52.824
						v108.218c0,7.391-5.008,12.553-12.177,12.553H424.905z"/>
				</g>
			</g>
			<g>
				<path fill="#009FBD" d="M589.939,255.57h-6.667H475.989l40.443-69.797H460.89l-73.084,125.159h30.229h24.325h42.451v70.173
					h55.358v-70.173l41.771,0.005c0.175,0.005-4.18,0.001-4-0.004l8,0c14.725-0.62,23.333-12.617,23.333-27.495
					C609.272,268.556,604.666,256.186,589.939,255.57z"/>
			</g>
			<g>
				<g>
					<path fill="#646467" d="M772.96,381.357c-7.169,0-12.176-5.162-12.176-12.553V267.802c0-11.914-2.29-21.045-6.807-27.14
						c-2.521-3.398-7.225-7.923-18.828-7.923c-7.723,0-13.878,2.725-18.819,8.332c-5.238,5.939-7.783,14.093-7.783,24.928v102.806
						c0,7.391-5.008,12.553-12.178,12.553h-20.683c-7.17,0-12.177-5.162-12.177-12.553V267.802c0-11.915-2.29-21.046-6.806-27.139
						c-2.522-3.398-7.225-7.924-18.829-7.924c-8.019,0-14.035,2.63-18.933,8.278c-5.162,5.947-7.67,14.117-7.67,24.981v102.806
						c0,7.391-5.008,12.553-12.178,12.553h-20.682c-7.17,0-12.178-5.162-12.178-12.553V203.232c0-7.39,5.008-12.552,12.178-12.552
						h20.682c5.056,0,9.117,2.709,11.015,6.921c1.396-1.018,2.854-1.989,4.376-2.915c8.714-5.292,19.302-7.975,31.47-7.975
						c12.181,0,22.94,2.811,31.981,8.353c5.382,3.301,10.089,7.447,14.084,12.394c4.475-4.835,9.531-8.941,15.121-12.271
						c9.451-5.625,21.048-8.475,34.472-8.475c20.873,0,37.091,7.083,48.204,21.052c10.618,13.354,16.003,31.126,16.003,52.824
						v108.217c0,7.391-5.008,12.553-12.177,12.553H772.96z"/>
				</g>
			</g>
		</g>
	</g>
	<path fill="#C8C5C2" d="M663.616,448.3c9.394,0,17.084,2.889,17.084,6.419c0,3.536-7.69,6.424-17.084,6.424H360.393
		c-9.41,0-17.092-2.888-17.092-6.424c0-3.53,7.682-6.419,17.092-6.419H663.616z"/>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>


================================================================================

--- RUTA: assets\m4m_2_sin fondo.png ---
[ARCHIVO BINARIO - NO SE PUEDE LEER COMO TEXTO]


================================================================================

--- RUTA: components\AlarmsView.vue ---
<template>
  <div>
    <h2>Alarms</h2>
    <div class="controls">
      <label>Device: <input v-model="memberId" placeholder="MemberId"/></label>
      <label>Show only unresolved: <input type="checkbox" v-model="onlyUnresolved"/></label>
      <button @click="loadAlarms">Load</button>
    </div>

    <div v-if="loading">Loading alarms...</div>
    <table v-if="!loading" class="table">
      <thead><tr><th>Device</th><th>Code</th><th>Abstract</th><th>Detail</th><th>Generated At</th><th>Reported At</th></tr></thead>
      <tbody>
        <tr v-for="a in alarms" :key="a.id">
          <td>{{ a.device?.member_id || '-' }}</td>
          <td>{{ a.error_code }}</td>
          <td>{{ a.abstract }}</td>
          <td>{{ a.detail }}</td>
          <td>{{ formatDate(a.generated_at) }}</td>
          <td>{{ formatDate(a.reported_at) }}</td>
        </tr>
      </tbody>
    </table>
    <div v-if="alarms.length===0 && !loading">No alarms found.</div>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { API } from '../api'
const alarms = ref([])
const loading = ref(false)
const memberId = ref('')
const onlyUnresolved = ref(true)

function formatDate(s){ if(!s) return ''; try{ return new Date(s).toLocaleString() }catch(e){ return s } }

// classification rule: consider ErrorReport with abstract 'ALRM' OR is_resolved==false as an alarm
function isAlarm(er){
  if(!er) return false
  const abstract = (er.abstract||'').toString().toUpperCase()
  if(abstract === 'ALRM') return true
  if(er.is_resolved === false) return true
  return false
}

async function loadAlarms(){
  loading.value = true
  try {
    // We request notifications then filter client-side; server supports member_id/error_code but simpler to fetch and filter
    const params = {}
    if(memberId.value) params.member_id = memberId.value
    const data = await API.getNotifications(params) || []
    let list = data.filter(isAlarm)
    if(onlyUnresolved.value) list = list.filter(x => x.is_resolved === false)
    alarms.value = list
  } catch(e){ alert('Error loading alarms: '+e.message) }
  finally{ loading.value = false }
}

loadAlarms()
defineExpose({ loadAlarms })
</script>


================================================================================

--- RUTA: components\Dashboard.vue ---
<!-- src/components/Dashboard.vue -->
<template>
  <div class="dashboard-root">
    <div class="page-card">
      <!-- Reutilizamos el componente DeviceList (tu archivo) -->
      <DeviceList />
    </div>
  </div>
</template>

<script setup>
import DeviceList from './DeviceList.vue'  // asegúrate de que la ruta es correcta
</script>

<style scoped>
/* Root ocupa todo el espacio disponible en .content */
.dashboard-root {
  height: 100%;
  min-height: 0;
  display: flex;
  flex-direction: column;
}

/* Page card ocupa toda el area con scroll interno si hace falta */
.page-card {
  background: #fff;
  border-radius: 12px;
  padding: 22px;
  box-shadow: 0 10px 30px rgba(2,6,23,0.04);
  width: 100%;
  box-sizing: border-box;
  flex: 1 1 auto;
  overflow: hidden;
}
</style>


================================================================================

--- RUTA: components\DeviceCard.vue ---
<template>
  <button class="device-card" :style="{borderLeft: '8px solid ' + color}" @click="$emit('click')">
    <div class="title">{{ device.member_id }}</div>
    <div class="subtitle">{{ device.name || 'Unnamed device' }}</div>
  </button>
</template>

<script setup>
defineProps({
  device: Object,
  color: { type: String, default: '#2b8cff' }
})
</script>

<style scoped>
.device-card{
  display:block;
  width:100%;
  text-align:center;
  padding:12px 8px;
  margin:8px 0;
  border-radius:6px;
  background:#fff;
  border:1px solid #eee;
  cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,0.04);
}
.device-card .title { font-weight:700; }
.device-card .subtitle { font-size:0.85em; color:#666; margin-top:6px; }
</style>


================================================================================

--- RUTA: components\DeviceDetail.vue ---
<template>
  <div class="device-detail">
    <h3>Device: {{ memberId }} <small v-if="device?.name">— {{ device.name }}</small></h3>
    <div class="meta">
      <div>Created: {{ formatDate(device?.created_at) }}</div>
      <div><button @click="goBack">Back to devices</button></div>
    </div>

    <div class="charts-grid">
      <div v-for="sensor in sensorsList" :key="sensor.code" class="chart-card">
        <div class="card-title">{{ sensor.title }}</div>
        <SensorChart :memberId="memberId" :sensorKey="sensor.code" :limit="120" />
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, watch } from 'vue'
import { useRouter } from 'vue-router'
import SensorChart from './SensorChart.vue'
import { API } from '../api'

const props = defineProps({
  memberId: { type: String, required: true }
})
const memberId = props.memberId
const router = useRouter()
const device = ref(null)

const sensorsList = [
  { code:'A2', title:'Helium level %' },
  { code:'A3', title:'Helium pressure PSI' },
  { code:'A5', title:'Water flow L/min' },
  { code:'A7', title:'Water temperature °C' },
  { code:'A8', title:'Coldhead RUO K' },
  { code:'A9', title:'Shield SI410 K' },
  { code:'A12', title:'Recondenser RuO K' },
  { code:'A13', title:'Recondenser SI410 K' }
]

function formatDate(s){ if(!s) return ''; try{ return new Date(s).toLocaleString() } catch(e){ return s } }

async function loadDevice(){
  try{
    // try to fetch device by member_id
    const all = await API.getDevices()
    device.value = (all || []).find(d => d.member_id === memberId) || { member_id: memberId }
  }catch(e){
    console.error(e)
  }
}

function goBack(){ router.push({ name: 'home' }) }

onMounted(() => loadDevice())
watch(() => props.memberId, () => loadDevice())
</script>

<style scoped>
.device-detail h3 { margin:0 0 8px 0 }
.meta { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px }
.charts-grid { display:grid; grid-template-columns: 1fr; gap:16px; }
.chart-card { background:#fff; padding:12px; border-radius:8px; border:1px solid #eee; box-shadow:0 6px 18px rgba(0,0,0,0.03); min-height:180px; max-width:60%}
.card-title { font-weight:700; margin-bottom:8px }
</style>

================================================================================

--- RUTA: components\DeviceList.vue ---
<template>
  <div class="page-root" role="application" aria-label="Sites list (paged)">
    <!-- Header centrado -->
    <header class="top-header">
      <h2 class="title">Sites status</h2>

      <div class="search-wrap">
        <input v-model="filter" placeholder="Filter sites..." class="filter" />
      </div>
    </header>

    <!-- Contenido principal -->
    <main class="center-column" aria-live="polite">
      <!-- Contenedor con altura fija -->
      <div class="list-area">
        <div class="list-stack" role="list">
          <div
            v-for="d in paginated"
            :key="d.id"
            class="site-row"
            :style="{ backgroundColor: colorFor(d) }"
            @click="goToDevice(d)"
            role="button"
            tabindex="0"
            @keyup.enter="goToDevice(d)"
          >
            <div class="site-text">{{ d.name || d.member_id }}</div>
          </div>

          <div v-if="!paginated.length" class="no-results">
            No sites found — prueba otro filtro
          </div>
        </div>
      </div>

      <!-- PAGINACIÓN siempre debajo -->
      <nav class="pagination" v-if="totalPages > 1" aria-label="Paginación de sitios">
        <button class="pg-btn" :disabled="page === 1" @click="prevPage">Prev</button>

        <ul class="pg-pages" role="list">
          <li v-for="p in pagesToShow" :key="p">
            <button
              class="pg-num"
              :aria-current="p === page ? 'page' : null"
              :class="{ active: p === page }"
              @click="goToPage(p)"
            >{{ p }}</button>
          </li>
        </ul>

        <button class="pg-btn" :disabled="page === totalPages" @click="nextPage">Next</button>
      </nav>
    </main>

    <!-- Leyenda -->
    <aside class="legend-card" aria-label="Status Legend">
      <h3>Status Legend</h3>

      <div class="leg-row"><span class="square ok"></span> All OK</div>
      <div class="leg-row"><span class="square low"></span> Low Warning</div>
      <div class="leg-row"><span class="square high"></span> High Warning</div>
      <div class="leg-row"><span class="square urgent"></span> Urgent</div>
      <div class="leg-row"><span class="square critical"></span> Critical</div>
      <div class="leg-row"><span class="square quench"></span> Quench</div>
    </aside>

    <!-- NUEVO PANEL DE FILTRO POR COLOR (fuera del aside) -->
    <div class="color-panel" role="region" aria-label="Filtro por color">
      <div class="color-panel-title">Filtrar por color</div>

      <div class="color-grid" role="list">
        <button
          v-for="opt in colorOptions"
          :key="opt.key"
          class="color-cell"
          :class="{ active: colorFilter === opt.key }"
          @click="colorFilter = opt.key"
          :aria-pressed="colorFilter === opt.key ? 'true' : 'false'"
          :title="opt.label"
          role="listitem"
        >
          <span class="cell-swatch" :style="{ background: opt.hex || '#fff', border: opt.hex ? 'none' : '1px solid #ddd' }"></span>
          <span class="cell-label">{{ opt.label }}</span>
        </button>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted, computed, watch } from 'vue'
import { useRouter } from 'vue-router'
import { API } from '../api'

/* SSE variable */
let es = null

/* Router + state */
const router = useRouter()
const devices = ref([])
const filter = ref('')
const loading = ref(false)

/* FILTRO POR COLOR: clave actual */
const colorFilter = ref('all')

/* Opciones basadas en la leyenda (con hex exactos) */
const colorOptions = [
  { key: 'all', label: 'All', hex: '' },
  { key: 'ok', label: 'All OK', hex: '#2ecc71' },        // OK
  { key: 'low', label: 'Low Warning', hex: '#3498db' },  // Low
  { key: 'high', label: 'High Warning', hex: '#f1c40f' },// High
  { key: 'urgent', label: 'Urgent', hex: '#ff8a1f' },    // Urgent
  { key: 'critical', label: 'Critical', hex: '#e74c3c' },// Critical
  { key: 'quench', label: 'Quench', hex: '#9b59b6' }     // Quench
]

/* PAGINACIÓN */
const perPage = 4
const page = ref(1)

/* --------- ORDENACIÓN NATURAL --------- */
function naturalCompare(a, b) {
  if (!a) return -1
  if (!b) return 1
  return a.toString().localeCompare(
    b.toString(),
    "en",
    { numeric: true, sensitivity: "base" }
  )
}

/* --------- colorFor() (mismos colores que la leyenda) --------- */
function colorFor(device) {
  // Mantenemos lógica original (member_id -> color)
  const mid = (device.member_id || '').toString().toUpperCase()
  if (mid.includes('MM')) return '#ff8a1f'   // Urgent / naranja
  if (mid.includes('PL')) return '#00c0ff'   // PL azul claro (no está en legend exacta)
  return '#2b8cff'                           // default azul
}

/* Mapeo de hex a clave de leyenda */
function hexForLegend(device) {
  const hex = colorFor(device).toLowerCase()
  const legendMap = {
    '#2ecc71': 'ok',
    '#3498db': 'low',
    '#f1c40f': 'high',
    '#ff8a1f': 'urgent',
    '#e74c3c': 'critical',
    '#9b59b6': 'quench'
  }
  for (const [k, v] of Object.entries(legendMap)) {
    if (k === hex) return v
  }

  // Mapeos para tus colores personalizados
  if (hex === '#00c0ff' || hex === '#2b8cff') {
    // asignamos a 'low' para agrupar azules
    return 'low'
  }

  return 'all'
}

/* Comprueba si un dispositivo coincide con la opción de filtro seleccionado */
function matchesColorFilter(device, key) {
  if (!key || key === 'all') return true
  const mapped = hexForLegend(device)
  return mapped === key
}

/* --------- FILTRADO + ORDENACIÓN (alfanumérica por defecto) --------- */
const filtered = computed(() => {
  const term = filter.value.trim().toLowerCase()

  // base array
  let arr = !term
    ? [...devices.value]
    : devices.value.filter(d =>
        (d.member_id || '').toLowerCase().includes(term) ||
        (d.name || '').toLowerCase().includes(term)
      )

  // aplicar filtro por color si se seleccionó otro que 'all'
  if (colorFilter.value && colorFilter.value !== 'all') {
    arr = arr.filter(d => matchesColorFilter(d, colorFilter.value))
  }

  // Orden alfanumérico natural por name o member_id
  return arr.sort((a, b) => naturalCompare(a.name || a.member_id, b.name || b.member_id))
})

/* Total páginas */
const totalPages = computed(() => Math.max(1, Math.ceil(filtered.value.length / perPage)))

/* Slice según página */
const paginated = computed(() => {
  const start = (page.value - 1) * perPage
  return filtered.value.slice(start, start + perPage)
})

/* Páginas visibles */
const pagesToShow = computed(() => {
  const total = totalPages.value
  const window = 5
  let start = Math.max(1, page.value - 2)
  let end = Math.min(total, start + window - 1)
  if (end - start < window - 1) start = Math.max(1, end - window + 1)
  const arr = []
  for (let i = start; i <= end; i++) arr.push(i)
  return arr
})

/* Ajuste de página si cambia la lista */
watch([() => filtered.value.length], () => {
  if (page.value > totalPages.value) page.value = totalPages.value
})

/* reset página al cambiar filtros para evitar páginas vacías */
watch([filter, colorFilter], () => { page.value = 1 })

/* Navegación */
function goToPage(n) { page.value = Math.min(Math.max(1, n), totalPages.value) }
function prevPage() { if (page.value > 1) page.value-- }
function nextPage() { if (page.value < totalPages.value) page.value++ }

/* Navegar a detalle */
function goToDevice(device) {
  router.push({ name: 'device-detail', params: { memberId: device.member_id } })
}

/* SSE: agregar o actualizar */
function addOrUpdateDevice(device) {
  if (!device || !device.id) return
  const idx = devices.value.findIndex(d => d.id === device.id)
  if (idx === -1) devices.value.unshift(device)
  else devices.value.splice(idx, 1, { ...devices.value[idx], ...device })
}

/* Carga inicial */
onMounted(async () => {
  // Bloquea scroll del body mientras el componente está montado (como antes)
  document.documentElement.style.overflow = 'hidden'
  document.body.style.overflow = 'hidden'

  // Inicializa SSE (ajusta la URL si corresponde)
  es = new EventSource('/api/devices/stream')

  es.addEventListener('new-device', (ev) => {
    try {
      const device = JSON.parse(ev.data)
      addOrUpdateDevice(device)
    } catch (err) {
      console.error('Invalid SSE payload', err)
    }
  })

  es.onerror = (err) => {
    console.warn('SSE error', err)
  }

  await loadDevices()
})

onUnmounted(() => {
  if (es) { es.close(); es = null }
  // Restaura scroll
  document.documentElement.style.overflow = ''
  document.body.style.overflow = ''
})

async function loadDevices() {
  loading.value = true
  try { devices.value = await API.getDevices() || [] }
  catch (e) { alert('Error loading devices: ' + (e.message || e)) }
  finally { loading.value = false }
}
</script>

<style scoped>
/* Root: fondo claro, sin scroll vertical */
.page-root {
  min-height: 100vh;
  height: 100vh;
  background: #ffffff;
  color: #122034;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  position: relative;
  overflow: hidden;
}

/* Header centrado: ahora coincide con la anchura de la columna central */
.top-header {
  width: 75%;                  /* igual que .center-column */
  padding: 28px 0 10px;
  box-sizing: border-box;
  margin-left: auto;           /* empuja para alinearse con la columna central */
  margin-right: 400px;         /* mantiene espacio para la leyenda y panel derecho */
}

.title {
  margin: 0;
  font-size: 26px;
  font-weight: 600;
  color: #20273a;
}

/* Search: centrado y con ancho igual al área de lista */
.search-wrap {
  display:flex;
  justify-content: center;     /* centra el input respecto a la columna */
  margin-top: 12px;
  width: 100%;
  box-sizing: border-box;
}
.filter {
  width: 600px;                            /* ancho igual que .list-area */
  max-width: calc(100vw - 380px);         /* fallback responsive */
  padding: 10px 14px;
  border-radius: 6px;
  border: 1px solid #e6e9ee;
  font-size: 14px;
}

/* Column central */
.center-column {
  width: 75%;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 12px;
  margin-right: 400px;
  box-sizing: border-box;
}

/* LIST AREA (altura fija para 4 filas exactas) */
.list-area {
  position: relative;
  width: 600px;
  max-width: calc(100vw - 380px);
  height: 196px; /* altura exacta para 4 filas (incluyendo gaps) */
  box-sizing: border-box;
}

/* Stack: mantiene 4 filas exactas sin scroll */
.list-stack {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 0;
  box-sizing: border-box;
  height: 196px;  /* 4 filas + gaps */
  overflow: hidden;
  width: 100%;
  align-items: stretch;
  justify-content: flex-start; /* filas pegadas arriba; espacio vacío abajo */
}

/* Each site row */
.site-row {
  height: 40px;
  border-radius: 6px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor: pointer;
  box-shadow: 0 6px 18px rgba(23,35,60,0.06);
  transition: transform .08s ease, box-shadow .12s ease;
  color: #071226;
  font-weight: 600;
}
.site-row:hover { transform: translateY(-3px); box-shadow: 0 12px 28px rgba(23,35,60,0.10); }

.site-text {
  padding: 6px 14px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.no-results {
  color: #6b7280;
  text-align: center;
  padding: 16px;
}

/* Legend card on right */
.legend-card {
  position: fixed;
  right: 36px;
  top: 100px;
  width: 220px;                  /* antes 200px */
  background: white;
  border-radius: 10px;
  padding: 10px 12px;            /* antes 14px 14px */
  box-shadow: 0 10px 26px rgba(10,20,40,0.10);
  z-index: 30;
  text-align: left;
}

.legend-card h3 {
  font-size: 17px;               /* antes ~18px */
  margin: 0 0 8px 0;
  font-weight: 600;
}

/* cada item reducido */
.leg-row {
  display: flex;
  align-items: center;
  gap: 8px;                      /* antes 10px */
  margin: 5px 0;                 /* antes 8px */
  color: #223047;
  font-size: 14px;               /* antes 13px */
}

/* cuadrados más pequeños */
.square {
  width: 14px;                   /* antes 14px */
  height: 14px;                  /* antes 14px */
  border-radius: 3px;
  display: inline-block;
}
.ok { background: #2ecc71 } .low { background: #3498db } .high { background: #f1c40f }
.urgent { background: #ff8a1f } .critical { background: #e74c3c } .quench { background: #9b59b6 }

/* NUEVO: PANEL DE FILTRO POR COLOR (fuera del aside), con grid 2 columnas */
.color-panel {
  position: fixed;
  right: 36px;
  bottom: 36px;             /* se ancla desde abajo (seguro en pantallas bajas) */
  width: 220px;
  background: white;
  border-radius: 10px;
  padding: 12px;
  box-shadow: 0 10px 30px rgba(10,20,40,0.08);
  z-index: 29;

  /* Evita salidas de pantalla: limita altura y permite scroll interno */
  max-height: calc(100vh - 120px); /* deja espacio superior para header/legend */
  overflow: auto;
}

.color-panel-title { font-weight: 600; font-size: 13px; margin-bottom: 10px; color:#223047; }

/* Grid: 2 columnas para que se vean todas las opciones */
.color-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
}

/* Cada celda */
.color-cell {
  display:flex;
  align-items:center;
  gap:8px;
  padding: 6px 8px;
  border-radius: 8px;
  background: #fafafa;
  border: 1px solid transparent;
  cursor: pointer;
  font-size: 13px;
  color: #223047;
  text-align: left;
}
.color-cell .cell-swatch {
  width: 18px;
  height: 18px;
  border-radius: 4px;
  box-shadow: 0 4px 10px rgba(10,20,40,0.06);
}
.color-cell .cell-label {
  font-size: 12px;
}

/* estado activo */
.color-cell.active {
  border-color: rgba(43,140,255,0.16);
  background: linear-gradient(90deg, rgba(43,140,255,0.04), rgba(0,192,255,0.02));
  box-shadow: 0 6px 16px rgba(43,140,255,0.04);
}

/* PAGINACIÓN FIJA DEBAJO (no absolute) */
.pagination {
  margin-top: 22px; /* separación visual de la lista */
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
}

/* botones de paginación */
.pg-btn {
  border: 1px solid #e6e9ee;
  background: white;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  box-shadow: 0 6px 18px rgba(23,35,60,0.03);
}
.pg-btn:disabled { opacity: 0.45; cursor: not-allowed; }

.pg-pages { display:flex; gap:8px; list-style:none; padding:0; margin:0; }
.pg-num {
  border: 1px solid #e6e9ee;
  background: white;
  padding: 6px 9px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}
.pg-num.active {
  background: linear-gradient(90deg,#2b8cff 0%, #00c0ff 100%);
  color: white;
  border-color: transparent;
  box-shadow: 0 8px 20px rgba(43,140,255,0.18);
}

/* En móvil: convertir a estático y ocupar ancho completo (igual que antes) */
@media (max-width: 900px) {
  .color-panel {
    position: static;
    right: auto;
    bottom: auto;
    top: auto;
    width: calc(100% - 40px);
    margin: 10px auto 20px;
    max-height: none;
    overflow: visible;
  }

  /* reducir ancho del buscador en pantallas pequeñas para mejor ajuste */
  .filter {
    width: calc(100% - 80px);
    max-width: calc(100% - 80px);
  }

  /* ajustar top-header para pantallas pequeñas */
  .top-header {
    width: calc(100% - 40px);
    margin-right: 0;
    margin-left: auto;
    padding-left: 20px;
    padding-right: 20px;
  }

  .center-column {
    width: calc(100% - 40px);
    margin-right: 0;
  }

  .list-area {
    width: 100%;
    max-width: 100%;
  }
}
</style>


================================================================================

--- RUTA: components\NotificationsView.vue ---
<template>
  <div>
    <h2>Notifications / Error Reports</h2>
    <div class="controls">
      <label>Filter device: <input v-model="memberId" placeholder="MemberId"/></label>
      <label>Filter code: <input v-model="errorCode" placeholder="Error code"/></label>
      <button @click="loadNotifications">Apply</button>
    </div>

    <div v-if="loading">Loading notifications...</div>
    <table v-if="!loading" class="table">
      <thead><tr><th>Device</th><th>Code</th><th>Abstract</th><th>Detail</th><th>Generated At</th></tr></thead>
      <tbody>
        <tr v-for="n in notifications" :key="n.id">
          <td>{{ n.device?.member_id || '-' }}</td>
          <td>{{ n.error_code }}</td>
          <td>{{ n.abstract }}</td>
          <td>{{ n.detail }}</td>
          <td>{{ formatDate(n.generated_at) }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { API } from '../api'
const notifications = ref([])
const loading = ref(false)
const memberId = ref('')
const errorCode = ref('')

function formatDate(s){ if(!s) return ''; try{ return new Date(s).toLocaleString() }catch(e){ return s } }

async function loadNotifications(){
  loading.value = true
  try {
    const params = {}
    if(memberId.value) params.member_id = memberId.value
    if(errorCode.value) params.error_code = errorCode.value
    notifications.value = await API.getNotifications(params) || []
  } catch(e){ alert('Error loading notifications: '+e.message) }
  finally{ loading.value = false }
}

loadNotifications()
defineExpose({ loadNotifications })
</script>


================================================================================

--- RUTA: components\SensorChart.vue ---
<template>
  <div class="sensor-chart">
    <!-- Controles eliminados según petición -->

    <canvas ref="canvas" class="chart-canvas" :style="{ height: height + 'px' }"></canvas>

    <div v-if="loading" style="margin-top:8px;color:#666">Loading...</div>
    <div v-if="error" style="margin-top:8px;color:crimson">{{ error }}</div>
  </div>
</template>

<script setup>
/*
 SensorChart.vue
 Props: memberId, sensorKey, limit, height
 Requires: frontend/src/api.js -> API.getSensorReadings(params)
*/

import { ref, onMounted, watch, onBeforeUnmount, nextTick } from 'vue'
import Chart from 'chart.js/auto'
import { API } from '../api'

// Props
const props = defineProps({
  memberId: { type: String, default: '' },
  sensorKey: { type: String, default: 'A2' },
  limit: { type: Number, default: 50 },
  height: { type: Number, default: 160 } // optional custom height
})

// local reactive copies so UI inputs don't immediately mutate parent props
const localMemberId = ref(props.memberId)
const localSensorKey = ref(props.sensorKey)
const localLimit = ref(props.limit)

watch(() => props.memberId, v => localMemberId.value = v)
watch(() => props.sensorKey, v => localSensorKey.value = v)
watch(() => props.limit, v => localLimit.value = v)

const canvas = ref(null)
let chart = null

const loading = ref(false)
const error = ref(null)

function fmtDate(iso){
  try { return new Date(iso).toLocaleString() }
  catch(e){ return iso }
}

// ====== COLOR MAPPING HELPERS ======
const SENSOR_COLOR_MAP = {
  // Nómbralos con la key/nombre tal como los pasas (case-insensitive)
  // Ejemplos:
  'a2': '#e63946', // rojo
  'a3': '#2b8cff',   // azul
  'pressure': '#ffb703',      // amarillo/naranja
  'humidity': '#06d6a0',      // verde menta
  // añade los que quieras aquí...
}

// Paleta fallback (hex colors)
const FALLBACK_PALETTE = [
  '#2b8cff', '#e63946', '#ffb703', '#06d6a0',
  '#8338ec', '#fb5607', '#00b4d8', '#9d4edd'
]

// simple hash function para index determinista
function hashStringToIndex(s, max) {
  let h = 2166136261 >>> 0
  for (let i = 0; i < s.length; i++) {
    h ^= s.charCodeAt(i)
    h = Math.imul(h, 16777619) >>> 0
  }
  return h % max
}

// devuelve color hex (string) para una sensor key/name dada
function colorForSensor(key) {
  console.log(key)
  if(!key) return FALLBACK_PALETTE[0]
  const normal = String(key).toLowerCase().trim()
  if (SENSOR_COLOR_MAP[normal]) return SENSOR_COLOR_MAP[normal]
  const idx = hashStringToIndex(normal, FALLBACK_PALETTE.length)
  return FALLBACK_PALETTE[idx]
}

// helper: convierte hex a rgba con alpha
function hexToRgba(hex, alpha = 0.12) {
  const h = hex.replace('#','')
  const bigint = parseInt(h.length === 3 ? h.split('').map(c=>c+c).join('') : h, 16)
  const r = (bigint >> 16) & 255
  const g = (bigint >> 8) & 255
  const b = bigint & 255
  return `rgba(${r},${g},${b},${alpha})`
}

async function fetchData(){
  loading.value = true
  error.value = null
  try{
    const params = {}
    if(localMemberId.value) params.member_id = localMemberId.value
    // backend may accept sensor_name or sensor_code; we pass sensor_name param
    if(localSensorKey.value) params.sensor_name = localSensorKey.value
    if(localLimit.value) params.limit = localLimit.value

    // API.getSensorReadings accepts object params per our api.js
    const data = await API.getSensorReadings(params).catch(e => { throw e })
    let readings = Array.isArray(data) ? data : []

    // Fallback: filter client-side if server didn't filter by sensor_name
    const key = (localSensorKey.value||'').toString().toLowerCase().trim()
    if(key){
      readings = readings.filter(r => {
        const code = (r.sensor && r.sensor.code) ? String(r.sensor.code).toLowerCase() : ''
        const name = (r.sensor && r.sensor.name) ? String(r.sensor.name).toLowerCase() : ''
        if(code === key) return true
        if(name.includes(key)) return true
        return false
      })
    }

    const points = readings.map(r => {
      const time = r.generated_at || r.received_at || null
      const value = (r.value_numeric !== undefined && r.value_numeric !== null) ? r.value_numeric : r.value_text
      return (time ? { t: time, v: Number(value) } : null)
    }).filter(Boolean).sort((a,b) => new Date(a.t) - new Date(b.t))

    // limit to last N
    const limited = (localLimit.value && localLimit.value>0) ? points.slice(-localLimit.value) : points
    return limited
  }catch(e){
    console.error('SensorChart fetch error', e)
    error.value = e.message || String(e)
    return []
  }finally{
    loading.value = false
  }
}

function destroyChart(){
  if(chart){
    try { chart.destroy() } catch(e){ /* ignore */ }
    chart = null
  }
}

async function renderChart(){
  await nextTick()
  destroyChart()
  const points = await fetchData()
  const ctx = canvas.value && canvas.value.getContext ? canvas.value.getContext('2d') : null
  if(!ctx) return

  // labels: raw timestamps (ISO) — Chart will display them as strings on axis
  function formatDate(ts) {
    const d = new Date(ts)
    const dd = String(d.getDate()).padStart(2, '0')
    const mm = String(d.getMonth() + 1).padStart(2, '0')
    const yyyy = d.getFullYear()
    const HH = String(d.getHours()).padStart(2, '0')
    const MM = String(d.getMinutes()).padStart(2, '0')
    return `${dd}/${mm}/${yyyy} ${HH}:${MM}`
  }

  const labels = points.map(p => formatDate(p.t))

  const dataset = points.map(p => (isFinite(p.v) ? p.v : null))

    chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: localSensorKey.value || 'Sensor',
        data: dataset,
        tension: 0.25,
        spanGaps: true,
        borderWidth: 2,
        borderColor: colorForSensor(localSensorKey.value),

        fill:true,
        backgroundColor: hexToRgba(colorForSensor(localSensorKey.value), 0.14),

        // Sin puntos por defecto
        pointRadius: 0,
        // Pero se muestran al pasar el ratón
        pointHoverRadius: 6,
        pointHoverBorderWidth: 2,
        pointHoverBorderColor: '#fff',
        pointHoverBackgroundColor: colorForSensor(localSensorKey.value),
        showLine: true
      }]
    },
    options: {
      // Hace que el hover seleccione el punto más cercano aunque el cursor
      // no esté exactamente encima (más amigable para aparecer el marcador)
      interaction: {
        mode: 'nearest',
        intersect: false
      },
      elements: {
        point: {
          // radio por defecto oculto (ya puesto en dataset), pero mantenlo por seguridad
          radius: 0,
          hoverRadius: 6
        }
      },
      plugins: {
        tooltip: {
          // tooltip sigue mostrando el valor; mantenemos la callback de título
          callbacks: {
            title: (items) => {
              const idx = items[0].dataIndex
              return formatDate(points[idx].t)
            },
            label: (context) => {
              const v = context.parsed.y
              return (typeof v === 'number') ? `Value: ${v}` : String(v)
            }
          }
        }
      }
    }
  })

}


async function reload(){
  await renderChart()
}

onMounted(() => { renderChart() })
onBeforeUnmount(() => destroyChart())

// react to local input changes
watch([localMemberId, localSensorKey, localLimit], () => {
  // small debounce: avoid spamming renders if user types fast
  if(this && typeof this.__timeout !== 'undefined') clearTimeout(this.__timeout)
  // simple debounce
  setTimeout(() => renderChart(), 250)
})

defineExpose({ reload })
</script>

<style scoped>
.sensor-chart { width:100%; }
.chart-canvas { width:100% !important; height: 80% !important; display:block; }
.controls input{ margin-left:6px }
</style>


================================================================================

--- RUTA: components\SensorsView.vue ---
<template>
  <div>
    <h2>Sensors readings</h2>

    <div class="controls">
      <label>Filter device:
        <input v-model="memberId" placeholder="MemberId (empty = all)"/>
      </label>
      <label style="margin-left:12px">Entries per page:
        <select v-model.number="pageSize">
          <option v-for="n in [10,25,50,100]" :key="n" :value="n">{{n}}</option>
        </select>
      </label>
      <input v-model="q" placeholder="Search..." style="float:right" />
      <button @click="loadReadings">Apply</button>
    </div>

    <div v-if="loading">Loading readings...</div>

    <div v-if="!loading && rows.length===0">No readings found.</div>

    <div v-if="!loading && rows.length">
      <table class="table pivot">
        <thead>
          <tr>
            <th @click="sortBy('time')" :class="{sortable:true}">Date</th>
            <th v-for="col in columns" :key="col.key" @click="sortBy(col.key)" :class="{sortable:true}">
              <div class="col-title">{{ col.title }}</div>
              <div class="col-unit">{{ col.unit }}</div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="r in pagedData" :key="r.time">
            <td class="time">{{ formatDate(r.time) }}</td>
            <td v-for="col in columns" :key="col.key">
              <div v-if="r.values[col.key] !== undefined">
                <span v-if="isNumber(r.values[col.key])">{{ formatNumber(r.values[col.key]) }}</span>
                <span v-else>{{ r.values[col.key] }}</span>
              </div>
              <div v-else class="empty-cell">&nbsp;</div>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="pager">
        <button @click="prevPage" :disabled="page===1">Prev</button>
        <span>Page {{page}} / {{totalPages}}</span>
        <button @click="nextPage" :disabled="page===totalPages">Next</button>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'
import { API } from '../api'

// Map from sensor code (A2, A3...) to display key, title and unit
const SENSOR_MAP = {
  A2: { key:'He_Level', title:'Helium level %', unit:'%' },
  A3: { key:'He_Pressure', title:'Helium pressure PSI', unit:'PSI' },
  A5: { key:'Water_flow', title:'Water flow L/min', unit:'L/min' },
  A7: { key:'Water_temp', title:'Water temperature °C', unit:'°C' },
  A8: { key:'Coldhead_RuO', title:'Coldhead RUO K', unit:'K' },
  A9: { key:'Shield_SI410', title:'Shield SI410 °K', unit:'K' },
  A12: { key:'Recon_RuO', title:'Recondenser RuO °K', unit:'K' },
  A13: { key:'Recon_SI410', title:'Recondenser SI410 °K', unit:'K' },
  RF: { key:'RF', title:'RF', unit:'' },
  CPR1: { key:'CPR1', title:'CPR1', unit:'' },
  CDC1: { key:'CDC1', title:'CDC1', unit:'' },
  FM: { key:'FM', title:'Fill Mode', unit:'' },
  SM: { key:'SM', title:'Service Mode', unit:'' },
  HO: { key:'HO', title:'Heater On', unit:'' },
  HDC: { key:'HDC', title:'Heater DutyCycle', unit:'' },
  F1: { key:'F1', title:'F1', unit:'' },
  F2: { key:'F2', title:'F2', unit:'' },
  F3: { key:'F3', title:'F3', unit:'' },
  F4: { key:'F4', title:'F4', unit:'' },
}

// reactive state
const memberId = ref('')
const page = ref(1)
const pageSize = ref(10)
const q = ref('')
const loading = ref(false)
const rawReadings = ref([]) // raw readings array from API
const columns = ref([])      // pivot columns metadata
const rows = ref([])         // pivot rows: [{time: ISOstring, values: {He_Level: val, ...}}]
const sortKey = ref('time')
const sortDir = ref(-1) // -1 desc, 1 asc

function formatDate(s){ if(!s) return ''; try { return new Date(s).toLocaleString() } catch(e) { return s } }
function isNumber(v){ return v !== null && v !== undefined && !isNaN(parseFloat(v)) }
function formatNumber(n){ if(n===null || n===undefined) return '' ; return Number(n).toFixed(2) }

function buildColumnsAndRows(readings) {
  const byTime = new Map()
  const colKeys = new Map()

  readings.forEach(r => {
    if(memberId.value && (!r.device || r.device.member_id !== memberId.value)) return

    const timeKey = r.generated_at || r.received_at || r.received_at
    if(!timeKey) return
    let t = timeKey
    try {
      const dt = new Date(timeKey)
      dt.setSeconds(0,0)
      t = dt.toISOString()
    } catch(_) { }

    const sensorName = r.sensor?.name || r.sensor?.code || r.sensor
    const code = r.sensor?.code || sensorName
    let key = sensorName
    if(code && SENSOR_MAP[code]) key = SENSOR_MAP[code].key

    if(!colKeys.has(key)) {
      let title = key
      let unit = ''
      const mapEntry = Object.values(SENSOR_MAP).find(e => e.key === key) || SENSOR_MAP[code]
      if(mapEntry){ title = mapEntry.title; unit = mapEntry.unit }
      colKeys.set(key, { key, title, unit })
    }

    if(!byTime.has(t)) byTime.set(t, {})
    const slot = byTime.get(t)
    slot[key] = (r.value_numeric !== null && r.value_numeric !== undefined) ? r.value_numeric : r.value_text
  })

  const cols = Array.from(colKeys.values())
  cols.sort((a,b) => a.title.localeCompare(b.title))
  const rowArr = Array.from(byTime.entries()).map(([time, values]) => ({ time, values }))
  rowArr.sort((a,b) => (new Date(a.time) - new Date(b.time)) * sortDir.value * -1)
  columns.value = cols
  rows.value = rowArr
}

async function loadReadings(){
  loading.value = true
  try{
    const params = memberId.value ? `?member_id=${encodeURIComponent(memberId.value)}` : ''
    const data = await API.getSensorReadings(params ? params : '')
    rawReadings.value = data || []
    buildColumnsAndRows(rawReadings.value)
    page.value = 1
  }catch(e){
    alert('Error loading readings: ' + e.message)
    console.error(e)
  }finally{
    loading.value = false
  }
}

function sortBy(key){
  if(sortKey.value === key) sortDir.value = -sortDir.value
  else { sortKey.value = key; sortDir.value = -1 }
  if(sortKey.value === 'time'){
    rows.value.sort((a,b) => (new Date(a.time) - new Date(b.time)) * sortDir.value)
  } else {
    rows.value.sort((a,b) => {
      const va = a.values[sortKey.value]; const vb = b.values[sortKey.value]
      const na = isNumber(va) ? Number(va) : (va||'').toString()
      const nb = isNumber(vb) ? Number(vb) : (vb||'').toString()
      if(na < nb) return -1 * sortDir.value
      if(na > nb) return 1 * sortDir.value
      return 0
    })
  }
}

const filtered = computed(() => {
  if(!q.value) return rows.value
  const term = q.value.toLowerCase()
  return rows.value.filter(r => {
    if(r.time.toLowerCase().includes(term)) return true
    for(const k in r.values){
      const v = r.values[k]; if(v && String(v).toLowerCase().includes(term)) return true
    }
    return false
  })
})

const totalPages = computed(() => Math.max(1, Math.ceil(filtered.value.length / pageSize.value)))
const pagedData = computed(() => {
  const start = (page.value - 1) * pageSize.value
  return filtered.value.slice(start, start + pageSize.value)
})

function prevPage(){ if(page.value>1) page.value-- }
function nextPage(){ if(page.value < totalPages.value) page.value++ }

loadReadings()

defineExpose({ loadReadings })

</script>

<style scoped>
.table.pivot th { text-align:left; vertical-align:bottom; padding:8px }
.col-title { font-weight:600 }
.col-unit { font-size:0.75em; color:#666 }
.time { white-space:nowrap; }
.empty-cell { color:#999; }
.sortable { cursor:pointer; user-select:none }
.pager { margin-top:12px; display:flex; gap:8px; align-items:center }
.controls input{ margin-left:6px; margin-right:6px }
</style>


================================================================================

--- RUTA: components\Sidebar.vue ---
<!-- src/components/Sidebar.vue -->
<template>
  <nav class="sidebar-nav" aria-label="Main navigation">
    <ul class="menu-list" role="menu">
      <!-- Dashboard -->
      <li role="none">
        <button class="menu-item" @click="goHome" role="menuitem" :title="collapsed ? 'Dashboard' : ''">
          <span class="menu-icon" aria-hidden>
            <!-- icon: home -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 11.5L12 4l9 7.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 21h14a1 1 0 0 0 1-1V11.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </span>
          <span class="menu-label">Dashboard</span>
        </button>
      </li>

      <!-- divider -->
      <li><hr class="menu-divider" /></li>

      <!-- Operaciones (solo etiqueta/heading) -->
      <li v-if="!collapsed" class="menu-heading">MANAGMENT</li>

      <!-- Ayuda -->
      <li role="none">
        <button class="menu-item" @click="openHelp" role="menuitem" :title="collapsed ? 'Add FSE' : ''">
          <span class="menu-icon" aria-hidden>
            <!-- icono herramientas -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M14.7 6.3l3 3-8.4 8.4H6.3v-3L14.7 6.3z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M17.1 3.9l3 3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
          </span>
          <span class="menu-label">Add FSE</span>
        </button>
        <button class="menu-item" @click="openHelp" role="menuitem" :title="collapsed ? 'Add Site' : ''">
          <span class="menu-icon" aria-hidden>
            <!-- icono + -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M12 5v14" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M5 12h14" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </span>
          <span class="menu-label">Add Site</span>
        </button>
      </li>
    </ul>

    <!-- Spacer: empuja footer al fondo -->
    <div class="sidebar-spacer" />

    <!-- Footer: saludo / usuario -->
    <div :class="['sidebar-footer', { collapsed }]">
      <div class="user-info">

        <!-- SOLO mostrar avatar cuando está colapsado -->
        <div v-if="collapsed" class="avatar" aria-hidden>
          <svg width="30" height="30" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="8" r="3.2" stroke="currentColor" stroke-width="1.2"/>
            <path d="M4 20c1.5-3 4.5-5 8-5s6.5 2 8 5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
          </svg>
        </div>

        <!-- DESPLEGADO: texto + avatar a la derecha -->
        <div v-else class="user-meta-row">
          <div class="user-meta">
            <div class="user-name">Hola, {{ displayName }}</div>
          </div>

          <!--avatar a la derecha -->
          <div class="avatar" aria-hidden>
            <svg width="30" height="30" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="8" r="3.2" stroke="currentColor" stroke-width="1.2"/>
              <path d="M4 20c1.5-3 4.5-5 8-5s6.5 2 8 5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
          </div>
        </div>
      </div>
    </div>
  </nav>
</template>

<script setup>
import { computed } from 'vue'
import { useRouter } from 'vue-router'
import { defineProps } from 'vue'

const props = defineProps({
  collapsed: { type: Boolean, default: false }
})

const router = useRouter()

function goHome(){ router.push({ name: 'home' }) }
function openHelp(){ window.open('https://your-docs.local','_blank') }
function goProfile(){ router.push({ name: 'profile' }).catch(()=>{}) }
function openProfile(){ router.push({ name: 'profile' }).catch(()=>{}) }

// obtiene nombre de usuario desde localStorage (fallback a 'Usuario')
let raw = null
try { raw = JSON.parse(localStorage.getItem('user') || 'null') } catch(e){ raw = null }
const displayName = computed(() => {
  if(!raw) return 'Usuario'
  if(raw.username) return raw.username
  if(raw.name) return raw.name
  return String(raw.id || raw.email || 'Usuario')
})
</script>

<style scoped>
.menu-list { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:6px; }
.menu-item { width:100%; border:none; background:transparent; color:inherit; display:flex; align-items:center; gap:12px; padding:10px 6px; border-radius:8px; cursor:pointer; text-align:left; }
.menu-item:hover { background: rgba(255,255,255,0.03); }
.menu-icon { width:28px; height:28px; display:inline-flex; align-items:center; justify-content:center; }
.menu-label { font-weight:500; color: #fff; }

.menu-divider { border:0; border-top:1px solid rgba(255,255,255,0.25); margin:8px 0; }

.menu-heading { color: rgba(255,255,255,0.7); font-size:0.85rem; padding:6px 6px; }

.sidebar-spacer { flex:1 1 auto; }

.sidebar-footer { display:flex; align-items:center; gap:10px; padding:8px; border-radius:8px; color:#fff; }
.sidebar-footer .avatar { width:36px; height:36px; display:flex; align-items:center; justify-content:center; border-radius:6px; background: rgba(255,255,255,0.03); }
.sidebar-footer .user-meta { display:flex; flex-direction:column; gap:4px; }
.sidebar-nav {
  display: flex;
  flex-direction: column;
  height: 100%;
}
.user-name { font-weight:600; font-size:0.95rem; color:#fff; }
.user-meta-row {
  display: flex;
  align-items: center;
  justify-content: space-between; /* texto izquierda / avatar derecha */
  width: 100%;
}

.avatar {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
  background: rgba(255,255,255,0.03);
}

/* collapsed footer: show only avatar */
.sidebar-footer.collapsed { justify-content:center; padding:6px; }
.sidebar-footer.collapsed .user-meta { display:none; }
</style>


================================================================================

--- RUTA: components\Topbar.vue ---
<!-- src/components/Topbar.vue -->
<template>
  <header class="topbar" role="banner">
    <div class="left-row">
      <button
        class="toggle-btn"
        @click="onToggle"
        :aria-expanded="!collapsed"
        aria-label="Toggle sidebar"
        type="button"
      >
        <svg v-if="!collapsed" width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <svg v-else width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <div class="brand">
        <img v-if="logo" :src="logo" class="logo" alt="logo" />
        <h1 class="brand-title">Magnet Monitor</h1>
      </div>
    </div>

    <div class="top-actions">
      <!-- Botón que abre el menú -->
      <div class="menu-wrapper">
        <button class="icon-btn" @click="toggleMenu" aria-label="User menu" type="button">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M15 3H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M10 12h10m0 0l-3-3m3 3l-3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <!-- MENÚ DESPLEGABLE -->
        <div v-if="menuOpen" class="dropdown">
          <button class="dropdown-item" @click="emit('logout')">
            Cerrar Sesión
          </button>
        </div>
      </div>
    </div>
  </header>
</template>

<script setup>
import { defineProps, defineEmits, ref, onMounted, onBeforeUnmount } from 'vue'

const props = defineProps({
  collapsed: Boolean,
  logo: { type: String, default: null }
})

const emit = defineEmits(['toggle', 'logout'])

function onToggle() {
  emit('toggle')
}

/* --- MENÚ LOGOUT --- */
const menuOpen = ref(false)

function toggleMenu() {
  menuOpen.value = !menuOpen.value
}

function closeMenu(e) {
  if (!e.target.closest('.menu-wrapper')) {
    menuOpen.value = false
  }
}

onMounted(() => {
  document.addEventListener('click', closeMenu)
})
onBeforeUnmount(() => {
  document.removeEventListener('click', closeMenu)
})
</script>

<style scoped>
.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #0b0b0b;
  padding: 10px 16px;
  gap: 12px;
  color: white;
  height: 64px; /* más ancha como pediste */
  box-sizing: border-box;
}

.left-row {
  display:flex;
  align-items:center;
  gap:12px;
}

.toggle-btn,
.icon-btn {
  display:flex;
  align-items:center;
  justify-content:center;
  width:36px;
  height:36px;
  border-radius:8px;
  background:transparent;
  border:none;
  color:white;
  cursor:pointer;
  padding:4px;
}

.brand {
  display:flex;
  align-items:center;
  gap:10px;
}
.logo {
  height:32px;
  border-radius:6px;
}
.brand-title {
  margin:0;
  font-size:1.05rem;
  color:white;
}

.menu-wrapper {
  position: relative;
}

.dropdown {
  position: absolute;
  top: 42px;
  right: 0;
  background: #1a1a1a;
  border: 1px solid #333;
  border-radius: 8px;
  padding: 6px 0;
  width: 150px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  z-index: 20;
}

.dropdown-item {
  background: transparent;
  border: none;
  color: white;
  width: 100%;
  text-align: left;
  padding: 10px 14px;
  cursor: pointer;
  font-size: 0.95rem;
}
.dropdown-item:hover {
  background: #2a2a2a;
}
</style>


================================================================================

--- RUTA: layouts\MainLayout.vue ---
<template>
    <div class="main-layout">
        <Topbar :collapsed="collapsed" :logo="logo" @toggle="toggleSidebar" @logout="onLogout" />
        
        <div class="main-body">
            <aside :class="['sidebar', { collapsed }]">
                <Sidebar :collapsed="collapsed" />
            </aside>

            <section class="content">
                <router-view />
            </section>
        </div>
    </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import { useRouter } from 'vue-router'
import Sidebar from '../components/Sidebar.vue'
import Topbar from '../components/Topbar.vue'
import logoUrl from '../assets/logo.svg'

const collapsed = ref(false)
const wasUserCollapsed = ref(false) // ⬅️ para saber si el usuario cerró manualmente
const router = useRouter()
const logo = logoUrl || null

const BREAKPOINT = 1000

function persistCollapsed(v) {
    try { localStorage.setItem('sidebar_collapsed', JSON.stringify(v)) } catch (e) {}
}

function toggleSidebar() {
    collapsed.value = !collapsed.value
    wasUserCollapsed.value = collapsed.value // usuario lo cambia
    persistCollapsed(collapsed.value)
}

// restaurar el estado guardado
try {
    const saved = JSON.parse(localStorage.getItem('sidebar_collapsed') || 'false')
    collapsed.value = saved
    wasUserCollapsed.value = saved
} catch(e) {}

function handleResize() {
    const w = window.innerWidth

    if (w < BREAKPOINT) {
        // siempre cerrar en pantallas pequeñas
        collapsed.value = true
        // NO marcamos wasUserCollapsed porque no es acción del usuario
        persistCollapsed(true)
    } else {
        // tamaño grande: solo reabrir si el usuario NO lo había cerrado manualmente
        if (!wasUserCollapsed.value) {
            collapsed.value = false
            persistCollapsed(false)
        }
    }
}

onMounted(() => {
    handleResize()
    window.addEventListener('resize', handleResize)
})

onUnmounted(() => {
    window.removeEventListener('resize', handleResize)
})

function onLogout() {
    localStorage.removeItem('user')
    try { fetch('/api/logout', { method: 'POST', credentials: 'include' }) } catch(e){}
    router.replace({ name: 'login' })
}
</script>

<style scoped>
.logo { height:32px; border-radius:6px; }
</style>

================================================================================

--- RUTA: pages\HomeDashboard.vue ---
<!-- src/pages/HomeDashboard.vue -->
<template>
  <!-- Solo renderiza el Dashboard: el layout padre (MainLayout) ya lo incluye -->
  <Dashboard />
</template>

<script setup>
import Dashboard from '../components/Dashboard.vue'
</script>

<style scoped>
/* ningún estilo de layout aquí */
</style>


================================================================================

--- RUTA: pages\LoginView.vue ---
<template>
  <div class="login-page">
    <div class="auth-wrapper">
      <!-- Logo encima de la card -->
      <div class="brand-top" aria-hidden="true">
        <img :src="logo" alt="MagRUN logo" class="brand-logo" />
      </div>

      <div class="login-card" role="main" aria-labelledby="login-title">
        <h2 id="login-title" class="login-title">MagRUN Login</h2>
        <p class="small-muted">Introduce tus credenciales para acceder al panel</p>

        <form @submit.prevent="onSubmit" style="display:flex;flex-direction:column;gap:10px;margin-top:12px">
          <input v-model="username" placeholder="User" class="input" autocomplete="username" />
          <input v-model="password" placeholder="Password" type="password" class="input" autocomplete="current-password" />

          <div style="display:flex;justify-content:space-between;align-items:center">
            <label style="font-size:0.9rem; display:flex; align-items:center; gap:6px;">
              <input type="checkbox" v-model="remember" /> Remember
            </label>
            <button class="btn" :disabled="loading">{{ loading ? 'Logging…' : 'Login' }}</button>
          </div>

          <p class="forgot-wrapper">
            <button type="button" class="forgot-btn" @click="openForgotModal">Forgot password?</button>
          </p>

          <p v-if="error" style="color:crimson">{{ error }}</p>
        </form>
      </div>

      <!-- Modal emergente (centrado) -->
      <div v-if="showForgot" class="modal-overlay" role="dialog" aria-modal="true" aria-label="Forgot password">
        <div class="modal-card" role="document" @keydown.esc="closeForgot">
          <div class="modal-header">
            <h3>Forgot password</h3>
          </div>

          <div class="modal-body">
            <p class="small-muted">Enter your account email and we'll send instructions to reset your password.</p>

            <form @submit.prevent="onSendForgot" class="form" novalidate>
              <input
                v-model="forgotEmail"
                type="email"
                placeholder="Your email"
                class="input"
                :class="{ invalid: forgotTouched && !isEmailValid }"
                @blur="forgotTouched = true"
                aria-invalid="false"
                aria-describedby="forgot-help"
              />

              <div id="forgot-help" class="small-muted" v-if="forgotTouched && !isEmailValid" style="color:#c0392b">
                Please enter a valid email address.
              </div>

              <div class="actions">
                <button type="submit" class="btn" :disabled="forgotLoading">
                  <span v-if="forgotLoading">Sending…</span>
                  <span v-else>Send</span>
                </button>
                <button type="button" class="btn ghost" @click="closeForgot" :disabled="forgotLoading">Close</button>
              </div>
            </form>

            <div class="result" aria-live="polite">
              <div v-if="forgotSuccess" class="result-row success">
                <svg class="result-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="result-text">Si tu email existe en el sistema recibirás instrucciones.</span>
              </div>

              <div v-if="forgotError" class="result-row error">
                <svg class="result-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="result-text">{{ forgotErrorMsg }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'
import { useRouter } from 'vue-router'
import { API } from '../api'
import logo from '../assets/m4m_2_sin fondo.png'

const router = useRouter()

/* Login form */
const username = ref('')
const password = ref('')
const remember = ref(false)
const loading = ref(false)
const error = ref('')

async function onSubmit(){
  error.value = ''
  if(!username.value || !password.value) { error.value = 'Introduce usuario y contraseña'; return }
  loading.value = true
  try {
    let res
    if(API && typeof API.login === 'function'){
      res = await API.login({ username: username.value.trim(), password: password.value })
    } else {
      const resp = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: username.value.trim(), password: password.value }),
        credentials: 'include'
      })
      res = await resp.json()
    }

    if(res && res.success){
      try { localStorage.setItem('user', JSON.stringify(res.user || { username: username.value.trim() })) } catch(e){}
      router.replace({ name: 'home' })
    } else {
      error.value = (res && (res.detail || res.message)) || 'Credenciales inválidas'
    }
  } catch(e) {
    error.value = e.message || 'Error de red'
  } finally { loading.value = false }
}

/* Modal: forgot password */
const showForgot = ref(false)
const forgotEmail = ref('')
const forgotTouched = ref(false)
const forgotLoading = ref(false)
const forgotSuccess = ref(false)
const forgotError = ref(false)
const forgotErrorMsg = ref('')

function openForgotModal(){
  forgotEmail.value = ''
  forgotTouched.value = false
  forgotMsgClear()
  forgotSuccess.value = false
  forgotError.value = false
  showForgot.value = true
}

function closeForgot(){
  if(forgotLoading.value) return
  showForgot.value = false
  forgotMsgClear()
}

function forgotMsgClear(){
  forgotErrorMsg.value = ''
}

/* Email format validation (simple but robust) */
const isEmailValid = computed(() => {
  const v = (forgotEmail.value || '').trim()
  if(!v) return false
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  return re.test(v)
})

async function onSendForgot(){
  forgotTouched.value = true
  forgotError.value = false
  forgotErrorMsg.value = ''
  forgotSuccess.value = false

  if(!isEmailValid.value) {
    forgotError.value = true
    forgotErrorMsg.value = 'Please enter a valid email address.'
    return
  }

  forgotLoading.value = true
  try{
    const payload = { email: forgotEmail.value }
    const url = '/api/password_reset'

    const resp = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
      credentials: 'include'
    })

    let body = null
    const ct = resp.headers.get('content-type') || ''
    if(ct.includes('application/json')){
      try { body = await resp.json() } catch(e){ body = null }
    } else {
      try { const text = await resp.text(); body = text ? { text } : null } catch(e){ body = null }
    }

    if(resp.ok){
      forgotSuccess.value = true
      forgotError.value = false
      forgotMsgClear()
    } else {
      forgotSuccess.value = false
      forgotError.value = true
      if(body){
        const msg = body.detail || body.message || body.error || body.text || JSON.stringify(body)
        forgotErrorMsg.value = 'Error enviando email: ' + String(msg)
      } else {
        forgotErrorMsg.value = `Error enviando email (status ${resp.status})`
      }
    }
  } catch(e){
    forgotSuccess.value = false
    forgotError.value = true
    forgotErrorMsg.value = 'Error de red: ' + (e.message || e)
  } finally {
    forgotLoading.value = false
  }
}
</script>

<style scoped>
/* --------- estilos del login (coherentes con brand.css) --------- */
.login-page {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(180deg, #f6fbff, var(--bg));
  padding: 24px;
  box-sizing: border-box;
}

/* contenedor que agrupa logo + card para centrar juntos */
.auth-wrapper {
  max-width: 480px;
  width: 100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap: 12px;
}

/* logo encima de la card */
.brand-top {
  display:flex;
  justify-content:center;
  align-items:center;
  width:100%;
}
.brand-logo {
  max-width: 220px;
  width: 55%;
  height: auto;
  display:block;
  object-fit:contain;
  margin-bottom: 6px;
}

/* Card */
.login-card {
  width: 420px;
  max-width: calc(100% - 24px);
  background: var(--card-bg, #fff);
  border-radius: 12px;
  padding: 26px;
  box-shadow: var(--shadow, 0 10px 30px rgba(2,6,23,0.06));
  box-sizing: border-box;
}
.login-title { font-size:1.25rem; margin:0 0 6px 0; }
.small-muted { color: var(--muted, #9aa0a6); font-size:0.95rem; margin-top:4px; }

.input {
  width: 100%;
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid #e6e9ef;
  box-sizing: border-box;
}
.input.invalid {
  border-color: #c0392b;
  box-shadow: 0 0 0 3px rgba(192,57,43,0.06);
}

/* forgot link */
.forgot-wrapper { text-align: right; margin-top: 4px; }
.forgot-btn {
  background: none;
  border: none;
  color: var(--brand-500, #2b8cff);
  cursor: pointer;
  font-size: 0.9rem;
  text-decoration: underline;
}

/* buttons */
.btn {
  background: var(--brand-500, #2b8cff);
  color: #fff;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
}
.btn.ghost {
  background: #f5f5f5;
  color: #333;
  border: 1px solid #ddd;
}

/* modal styles (reutilizado) */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999;
  padding: 24px;
  box-sizing: border-box;
}

.modal-card {
  background: white;
  border-radius: 12px;
  padding: 0;
  width: 420px;
  max-width: 100%;
  box-shadow: 0 20px 40px rgba(0,0,0,0.25);
  overflow: hidden;
}

.modal-header {
  background: var(--brand-black, #0b0b0b);
  color: #fff;
  padding: 14px 18px;
  box-sizing: border-box;
}
.modal-header h3 { margin:0; font-size:1.05rem; }

.modal-body {
  padding: 18px;
  background: #fff;
}
.form { display:flex; flex-direction:column; gap:12px; margin-top:8px; }
.actions { display:flex; justify-content:space-between; gap:8px; margin-top:8px; }

/* result row */
.result { margin-top:12px; min-height:22px; }
.result-row { display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:8px; }
.result-row.success { background: #ecf9f0; color: #1f8a3d; }
.result-row.error { background: #fff4f4; color: #c0392b; }
.result-icon { flex: 0 0 auto; }
.result-text { font-size:0.95rem; }

/* responsive */
@media (max-width:480px){
  .login-card, .modal-card { width: 100%; padding: 18px; }
  .brand-logo { max-width: 180px; }
}
</style>


================================================================================

--- RUTA: pages\ResetPassword.vue ---
<template>
  <div class="login-page reset-page">
    <div class="auth-wrapper">
      <!-- Logo encima de la card -->
      <div class="brand-top" aria-hidden="true">
        <img :src="logo" alt="MagRUN logo" class="brand-logo" />
      </div>

      <div class="login-card reset-wrapper" role="main" aria-labelledby="reset-title">
        <h2 id="reset-title" class="login-title">Reset password</h2>

        <p class="small-muted">
          Introduce tu nueva contraseña para la cuenta asociada al enlace.
        </p>

        <p v-if="missingParams" class="error" style="margin-top:12px">
          Enlace inválido o incompleto. Asegúrate de usar el enlace enviado por email.
        </p>

        <p v-if="infoMessage" class="msg" style="margin-top:12px">{{ infoMessage }}</p>

        <form v-if="!missingParams" @submit.prevent="submit" class="form" novalidate>
          <label class="label">New password</label>
          <input
            v-model="pw1"
            type="password"
            placeholder="New password"
            class="input"
            :class="{ invalid: touched && !isPwValid }"
            @blur="touched = true"
            autocomplete="new-password"
          />

          <label class="label">Repeat new password</label>
          <input
            v-model="pw2"
            type="password"
            placeholder="Repeat new password"
            class="input"
            :class="{ invalid: touched && !pwMatch }"
            @blur="touched = true"
            autocomplete="new-password"
          />

          <div class="hint" v-if="touched && !isPwValid" style="color:#c0392b">
            La contraseña debe tener al menos 8 caracteres.
          </div>
          <div class="hint" v-if="touched && isPwValid && !pwMatch" style="color:#c0392b">
            Las contraseñas no coinciden.
          </div>

          <div class="actions" style="margin-top:12px">
            <button class="btn" :disabled="loading || !isPwValid || !pwMatch">
              <span v-if="!loading">Set password</span>
              <span v-else>Setting…</span>
            </button>
          </div>

          <p v-if="errorMessage" class="error" style="margin-top:12px">{{ errorMessage }}</p>

          <div class="back-row" style="margin-top:14px">
            <button type="button" class="link" @click="goToLogin">← Back to login</button>
          </div>
        </form>

        <div v-if="success" class="msg success" style="margin-top:12px">
          Contraseña establecida correctamente. Ahora puedes iniciar sesión.
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { API } from '../api'
import logo from '../assets/m4m_2_sin fondo.png'

const route = useRoute()
const router = useRouter()

// parámetros desde querystring
const uid = ref('')
const token = ref('')
onMounted(()=>{
  uid.value = (route.query.uid || '').toString()
  token.value = (route.query.token || '').toString()
})

// form state
const pw1 = ref('')
const pw2 = ref('')
const touched = ref(false)
const loading = ref(false)
const errorMessage = ref('')
const infoMessage = ref('')
const success = ref(false)

// detectar si faltan parámetros
const missingParams = computed(()=> !uid.value || !token.value)

// validaciones
const isPwValid = computed(()=> (pw1.value || '').length >= 8)
const pwMatch = computed(()=> pw1.value === pw2.value)

// base URL para API (usar proxy o VITE_API_BASE)
const API_BASE = (import.meta.env.VITE_API_BASE || '').replace(/\/$/, '')
const passwordResetConfirmUrl = API_BASE ? `${API_BASE}/api/password_reset_confirm` : '/api/password_reset_confirm'

function goToLogin(){ router.replace({ name: 'login' }) }

/* submit: envía uid, token y new_password */
async function submit(){
  errorMessage.value = ''
  infoMessage.value = ''
  touched.value = true

  if(missingParams.value){
    errorMessage.value = 'Enlace inválido.'
    return
  }
  if(!isPwValid.value){
    errorMessage.value = 'La contraseña debe tener al menos 8 caracteres.'
    return
  }
  if(!pwMatch.value){
    errorMessage.value = 'Las contraseñas no coinciden.'
    return
  }

  loading.value = true
  try{
    const payload = { uid: uid.value, token: token.value, new_password: pw1.value }

    let res = null
    if(API && typeof API.password_reset_confirm === 'function'){
      res = await API.password_reset_confirm(payload)
    } else {
      const resp = await fetch(passwordResetConfirmUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
        credentials: 'include'
      })
      const ct = resp.headers.get('content-type') || ''
      if(ct.includes('application/json')){
        res = await resp.json()
        res._status = resp.status
      } else {
        res = { success: resp.ok }
        res._status = resp.status
      }
    }

    if(res && (res.success || res.ok || res._status === 200)){
      success.value = true
      setTimeout(()=> router.replace({ name: 'login' }), 1200)
    } else {
      const msg = (res && (res.detail || res.message || res.error)) || `Error (${res && res._status ? res._status : 'unknown'})`
      errorMessage.value = 'Error al establecer la contraseña: ' + msg
    }
  }catch(e){
    console.error('Reset password error:', e)
    errorMessage.value = 'Error de red: ' + (e.message || e)
  }finally{
    loading.value = false
  }
}
</script>

<style scoped>
/* Reutiliza estilos similares al login para mantener coherencia */
.login-page {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(180deg, #f6fbff, var(--bg));
  padding: 24px;
  box-sizing: border-box;
}

/* contenedor logo + card */
.auth-wrapper {
  max-width: 480px;
  width: 100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap: 12px;
}

/* logo */
.brand-top { display:flex; justify-content:center; align-items:center; width:100%; }
.brand-logo { max-width: 220px; width: 55%; height: auto; display:block; object-fit:contain; margin-bottom:6px; }

/* Card similar a login */
.login-card {
  width: 420px;
  max-width: calc(100% - 24px);
  background: var(--card-bg, #fff);
  border-radius: 12px;
  padding: 26px;
  box-shadow: var(--shadow, 0 10px 30px rgba(2,6,23,0.06));
  box-sizing: border-box;
}

/* adjust */
.reset-wrapper { width: 100%; }
.login-title { font-size:1.25rem; margin:0 0 6px 0; }
.small-muted { color: var(--muted, #9aa0a6); font-size:0.95rem; margin-top:4px; }

.form { display:flex; flex-direction:column; gap:10px; margin-top:12px; }
.label { font-size:0.95rem; margin-top:8px; color:#222; }
.input {
  width: 100%;
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid #e6e9ef;
  box-sizing: border-box;
}
.input.invalid { border-color:#c0392b; box-shadow: 0 0 0 3px rgba(192,57,43,0.06); }

.actions { display:flex; justify-content:flex-start; gap:8px; margin-top:8px; }
.btn {
  background: var(--brand-500, #2b8cff);
  color: #fff;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
}
.hint { color:#666; font-size:0.92rem; margin-top:6px; }

.error { color:#c0392b; margin-top:8px; }
.msg.success { color: #1f8a3d; margin-top:8px; }

.back-row .link { background:none; border:none; color:var(--brand-500); cursor:pointer; padding:0; text-decoration:underline; }

@media (max-width:480px){
  .login-card { width: 100%; padding: 18px; }
  .brand-logo { max-width: 180px; }
}
</style>


================================================================================

--- RUTA: router\index.js ---
// src/router/index.js
import { createRouter, createWebHistory } from 'vue-router'

/* Layout */
import MainLayout from '../layouts/MainLayout.vue'

/* Pages */
import LoginView from '../pages/LoginView.vue'
import HomeDashboard from '../pages/HomeDashboard.vue'

/* Child pages (rendered inside MainLayout.content) */
import ResetPassword from '../pages/ResetPassword.vue'
import DeviceDetail from '../components/DeviceDetail.vue'
import SensorsView from '../components/SensorsView.vue'
import NotificationsView from '../components/NotificationsView.vue'

// define routes
const routes = [
  // public
  { path: '/login', name: 'login', component: LoginView },

  { path: '/reset-password', name: 'reset-password', component: ResetPassword },
  // Protected area wrapped by MainLayout
  {
    path: '/',
    component: MainLayout,
    // you can add meta: { requiresAuth: true } if you use meta guards
    children: [
      // Home (dashboard)
      { path: '', name: 'home', component: HomeDashboard },

      // Device detail - will render inside MainLayout content area
      { path: 'device/:memberId', name: 'device-detail', component: DeviceDetail, props: true },

      // Other views
      { path: 'sensors', name: 'sensors', component: SensorsView },
      { path: 'notifications', name: 'notifications', component: NotificationsView },
    ]
  },

  // fallback
  { path: '/:catchAll(.*)', redirect: '/' }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

// simple auth guard (keeps same semantics you had)
router.beforeEach((to, from, next) => {
  const publicPages = ['login', 'reset-password']
  const isPublic = publicPages.includes(to.name)
  const isLogged = !!localStorage.getItem('user')
  if(!isPublic && !isLogged) {
    return next({ name: 'login' })
  }
  if(to.name === 'login' && isLogged) {
    return next({ name: 'home' })
  }
  next()
})

export default router


================================================================================

